{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/util/DomUtil.js","webpack:///./src/util/IconUtil.js","webpack:///./src/util/ImageUtil.js","webpack:///./src/util/MatrixUtil.js","webpack:///./src/util/TrigUtil.js","webpack:///./src/util/Utils.js","webpack:///./src/DistortableImageOverlay.js","webpack:///./src/DistortableCollection.js","webpack:///./src/edit/getEXIFdata.js","webpack:///./src/edit/handles/EditHandle.js","webpack:///./src/edit/handles/DistortHandle.js","webpack:///./src/edit/handles/DragHandle.js","webpack:///./src/edit/handles/FreeRotateHandle.js","webpack:///./src/edit/handles/LockHandle.js","webpack:///./src/edit/handles/RotateHandle.js","webpack:///./src/edit/handles/ScaleHandle.js","webpack:///./src/iconsets/IconSet.js","webpack:///./src/iconsets/KeymapperIconSet.js","webpack:///./src/iconsets/ToolbarIconSet.js","webpack:///./src/edit/actions/EditAction.js","webpack:///./src/edit/actions/BorderAction.js","webpack:///./src/edit/actions/DeleteAction.js","webpack:///./src/edit/actions/DistortAction.js","webpack:///./src/edit/actions/DragAction.js","webpack:///./src/edit/actions/ExportAction.js","webpack:///./src/edit/actions/FreeRotateAction.js","webpack:///./src/edit/actions/GeolocateAction.js","webpack:///./src/edit/actions/LockAction.js","webpack:///./src/edit/actions/OpacityAction.js","webpack:///./src/edit/actions/RestoreAction.js","webpack:///./src/edit/actions/RotateAction.js","webpack:///./src/edit/actions/ScaleAction.js","webpack:///./src/edit/actions/StackAction.js","webpack:///./src/edit/actions/UnlockAction.js","webpack:///./src/edit/toolbars/DistortableImage.PopupBar.js","webpack:///./src/edit/toolbars/DistortableImage.ControlBar.js","webpack:///./src/edit/DistortableImage.Edit.js","webpack:///./src/edit/DistortableCollection.Edit.js","webpack:///./src/components/DistortableImage.Keymapper.js","webpack:///./src/mapmixins/DoubleClickZoom.js","webpack:///./src/mapmixins/BoxCollector.js","webpack:///./src/mapmixins/DoubleClickLabels.js","webpack:///./src/mapmixins/MapMixins.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","L","DomUtil","extend","initTranslation","obj","this","translation","getMatrixString","is3d","Browser","webkit3d","gecko3d","ie3d","matrix","str","join","console","log","toggleClass","el","className","hasClass","removeClass","addClass","confirmDelete","window","confirm","confirmImageDelete","confirmDeletes","confirmImagesDeletes","warningMsg","IconUtil","ref","test","replace","addClassToSvg","container","loader","svg","querySelector","toggleXlink","ref1","ref2","use","toggled","getAttribute","setAttribute","toggleTitle","title1","title2","hasAttribute","ImageUtil","getCmPerPixel","overlay","map","_map","latLngToLayerPoint","getCorner","distanceTo","getElement","width","MatrixUtil","adj","multmm","a","b","j","cij","k","multmv","v","multsm","length","push","basisToPoints","x1","y1","x2","y2","x3","y3","x4","y4","project","x","y","general2DProjection","x1s","y1s","x1d","y1d","x2s","y2s","x2d","y2d","x3s","y3s","x3d","y3d","x4s","y4s","x4d","y4d","TrigUtil","calcAngle","unit","radiansToDegrees","Math","atan2","angle","PI","degreesToRadians","Utils","deleteImage","deleteImages","distortImage","dragImage","exportImage","exportImages","removeBorder","addBorder","freeRotateImage","geolocateImage","lockMode","lockImages","makeImageOpaque","makeImageTransparent","restoreImage","rotateImage","scaleImage","stackToFront","stackToBack","unlockImages","options","getNestedVal","nestedKey","reduce","DistortableImageOverlay","ImageOverlay","height","crossOrigin","edgeMinWidth","editable","selected","initialize","url","setOptions","_selected","_url","rotation","onAdd","_initImage","on","_reset","corners","_corners","zoomAnimation","any3d","_animateZoom","DomEvent","getPane","appendChild","_initImageDimensions","units","deg","setAngle","rad","eventParents","_eventParents","eP","keys","editing","enable","select","singleclickon","_singleClickListeners","singleclickoff","_resetClickListeners","singleclick","_singleClick","doubleClickZoom","enabled","doubleClickLabels","deselect","fire","onRemove","off","disable","originalImageWidth","getStyle","originalImageHeight","aspectRatio","parseInt","imageHeight","imageWidth","center","getCenter","offset","point","divideBy","unproject","subtract","add","_initialDimensions","getZoom","setBounds","latLngBounds","getCorners","e","type","isSelected","edit","_removeToolbar","_hideMarkers","stopPropagation","_programmaticGrouping","_addToolbar","_showMarkers","anyCollected","eachLayer","layer","setCorner","corner","latlng","toolbar","DistortableImage","PopupBar","_updateToolbarPos","edited","_cornerExceedsMapLats","zoom","exceedsTop","exceedsBottom","pow","setCorners","latlngObj","setCornersFromPoints","pointsObj","layerPointToLatLng","scaleBy","scale","scaledCorners","multiplyBy","getAngle","style","TRANSFORM","split","slice","row0x","row0y","row1x","row1y","determinant","round","Util","formatNum","currentAngle","angleToRotateBy","rotateBy","q","cos","sin","dragBy","formerPoint","newPoint","transCorners","delta","restore","equals","_getTranslateString","close","image","transformMatrix","_calculateProjectiveTransform","topLeft","warp","_leaflet_pos","event","latLngToNewLayerPoint","_latLngToNewLayerPoint","agg","latLngToCartesian","w","offsetWidth","h","offsetHeight","_subtract","distortableImageOverlay","id","Map","addInitHook","getContainer","DistortableCollection","FeatureGroup","exportOpts","exportStartUrl","statusUrl","exportUrl","_addEvents","_removeEvents","dragstart","_dragStartMultiple","drag","_dragMultiple","mousedown","_deselectOthers","contextmenu","_longPressMultiSelect","preventDefault","target","isCollected","getLayers","some","_toggleCollected","shiftKey","_dragStartPoints","_updateCollectionFromPoints","_toRemove","filter","_mode","_toMove","layersToMove","Transformation","forEach","movedPoints","transform","_getAvgCmPerPixel","imgs","sum","img","cm_per_pixel","generateExportJson","json","sections","_image","src","filename","zc","lat","lon","lng","images","getLayerId","image_file_name","nodes","reverse","avg_cm_per_pixel","distortableCollection","EXIF","getAllTags","GPS","GPSLatitude","GPSLongitude","GPSLatitudeRef","GPSLongitudeRef","GPSImgDirectionRef","GPSImgDirection","numerator","denominator","Orientation","GPSAltitude","GPSAltitudeRef","alert","EditHandle","Marker","_handled","_corner","markerOptions","draggable","zIndexOffset","_bindListeners","updateHandle","_unbindListeners","_onHandleDragStart","_onHandleDragEnd","_fireEdit","stop","_onHandleDrag","dragend","_calculateScalingFactor","latlngA","latlngB","centerPoint","formerRadiusSquared","_d2","newRadiusSquared","sqrt","dx","dy","calculateAngleDelta","initialAngle","DistortHandle","TYPE","icon","iconUrl","iconSize","iconAnchor","getLatLng","setLatLng","distortHandle","idx","DragHandle","formerLatLng","newLatLng","dragHandle","FreeRotateHandle","corner1","latLngToContainerPoint","corner2","abs","freeRotateHandle","LockHandle","interactive","unbindTooltip","_tooltipOn","mouseup","_tooltipOff","document","parentGroup","handlesArr","_lockHandles","_timer","setTimeout","_timeout","clearTimeout","getTooltip","handle","closeTooltip","bindTooltip","permanent","openTooltip","currentTarget","lockHandle","RotateHandle","rotateHandle","ScaleHandle","scaleHandle","IconSet","Class","_svg","_symbols","render","addSymbols","symbols","KeymapperIconSet","ToolbarIconSet","distortableImage","action_map","EditAction","Toolbar2","Action","toolbarIcon","html","tooltip","_overlay","_injectIconSet","_createIcon","args","iconOptions","_icon","_link","innerHTML","constructor","baseClass","match","_enableAction","_addSubToolbar","createElement","parentElement","_disableAction","editAction","BorderAction","_outlined","addHooks","_toggleBorder","DeleteAction","Edit","Backspace","group_action_map","_removeOverlay","_removeGroup","DistortAction","_distortMode","DragAction","D","_dragMode","ExportAction","isExporting","mouseLeaveSkip","isHooksExecuted","_getExport","exportTool","mouseEnterHandler","handleMouseEnter","mouseLeaveHandler","handleMouseLeave","resetState","detachMouseEventListeners","cancelExport","renderExportIcon","attachMouseEventListeners","runExporter","then","renderDownloadIcon","element","addEventListener","removeEventListener","renderCancelIcon","firstChild","FreeRotateAction","f","_freeRotateMode","GeolocateAction","getData","LockAction","u","isMode","_toggleLockMode","_lockGroup","OpacityAction","_transparent","link","_toggleOpacity","RestoreAction","ov","RotateAction","_rotateMode","ScaleAction","_scaleMode","StackAction","_toggledImage","_toggleOrder","UnlockAction","_unlockGroup","Popup","anchor","tools","_ul","children","clickTool","tool","item","click","popupBar","ACTIONS","MODES","distort","rotate","freeRotate","lock","actions","ControlBar","Control","controlBar","unlock","Handler","opacity","outline","keymap","Escape","editActions","bringToFront","_initModes","_initHandles","_appendHandlesandDragable","suppressToolbar","dblclick","nextMode","_onKeyDown","removeHooks","_disableDragging","_handles","remove","_enabled","_modes","action","indexOf","_dragHandles","layerGroup","addLayer","_scaleHandles","_distortHandles","_rotateHandles","_freeRotateHandles","_updateHandle","currentHandle","setOpacity","dragging","_enableDragging","handlerName","undefined","replaceTool","old","next","hasTool","_nextOrNone","addTool","removeTool","splice","getModes","removeLayer","Draggable","_updatePosition","currentPoint","_newPos","setMode","_unlock","_lock","_refresh","_stackUp","_stackDown","downloadable","Image","body","onload","nw","ne","sw","se","warpWebGl","fullResolutionSrc","bringToBack","hasMode","_deselect","getMode","maxLat","Infinity","raisedPoint","addTo","newMode","modesArray","group","_group","_exportOpts","startExport","_decollectAll","boxcollectend","_addCollections","oe","originalEvent","HTMLImageElement","box","boxCollectBounds","imgBounds","_latLngBoundsToNewLayerBounds","intersects","layersToRemove","customCollection","collection","clearInterval","updateInterval","position","Promise","resolve","opts","frequency","updater","data","JSON","parse","status_url","status","jpg","handleStatusRes","setInterval","req","Request","Date","now","method","fetch","res","ok","text","fetchStatusUrl","mergedOpts","form","FormData","append","stringify","reqOpts","Keymapper","_keymapper","_container","_buildContainer","_scrollWrapper","_wrap","_toggler","_createButton","_setMapper","_toggleKeymapper","disableClickPropagation","disableScrollPropagation","divider","toggler","wrap","display","button","control","insertAdjacentHTML","_iconset","_n","mobile","keymapper","DoubleClickZoom","include","_fireIfSingle","_onDoubleClick","_clicked","_clickTimeout","touch","sourceCapabilities","firesTouchEvents","_fireDOMEvent","oldZoom","zoomDelta","setZoom","setZoomAround","containerPoint","mergeOptions","boxCollector","boxZoom","BoxCollector","BoxZoom","_pane","_panes","overlayPane","_resetStateTimeout","_destroy","_onMouseDown","moved","_moved","_resetState","_clearDeferredResetState","which","disableTextSelection","disableImageDrag","_startPoint","mouseEventToContainerPoint","mousemove","_onMouseMove","_onMouseUp","_box","_point","_bounds","bounds","size","getSize","setPosition","min","_finish","enableTextSelection","enableImageDrag","containerPointToLatLng","getBottomLeft","getTopRight","DoubleClickLabels","labels","_labels","addGoogleMutant","mutantOptions","mutantOpacity","maxZoom","maxNativeZoom","minZoom","labelOpacity","_googleMutant","tileLayer","_addLabels","attribution","subdomains","ext"],"mappings":"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","file":"leaflet.distortableimage.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","L.DomUtil = L.extend(L.DomUtil, {\n  initTranslation(obj) {\n    this.translation = obj;\n  },\n\n  getMatrixString(m) {\n    var is3d = L.Browser.webkit3d || L.Browser.gecko3d || L.Browser.ie3d;\n\n    /*\n     * Since matrix3d takes a 4*4 matrix, we add in an empty row and column,\n     * which act as the identity on the z-axis.\n     * See:\n     *     http://franklinta.com/2014/09/08/computing-css-matrix3d-transforms/\n     *     https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function#M.C3.B6bius'_homogeneous_coordinates_in_projective_geometry\n     */\n    var matrix = [\n      m[0], m[3], 0, m[6],\n      m[1], m[4], 0, m[7],\n      0, 0, 1, 0,\n      m[2], m[5], 0, m[8],\n    ];\n\n    var str = is3d ? 'matrix3d(' + matrix.join(',') + ')' : '';\n\n    if (!is3d) {\n      console\n          .log('Your browser must support 3D CSS transforms' +\n          'in order to use DistortableImageOverlay.');\n    }\n\n    return str;\n  },\n\n  toggleClass(el, className) {\n    var c = className;\n    return this.hasClass(el, c) ?\n      this.removeClass(el, c) : this.addClass(el, c);\n  },\n\n  confirmDelete() {\n    return window.confirm(this.translation.confirmImageDelete);\n  },\n\n  confirmDeletes(n) {\n    if (n === 1) { return this.confirmDelete(); }\n\n    var translation = this.translation.confirmImagesDeletes;\n    var warningMsg = '';\n\n    if (typeof translation === 'function') {\n      warningMsg = translation(n);\n    } else {\n      warningMsg = translation;\n    }\n\n    return window.confirm(warningMsg);\n  },\n});\n","L.IconUtil = {\n  /* creates an svg elemenet with built in accessibility properties\n   * and standardized classes for styling, takes in the fragment\n   * identifier (id) of the symbol to reference. note for symplicity\n   * we allow providing the icon target with or without the '#' prefix\n   */\n  create(ref) {\n    if (/^#/.test(ref)) {\n      ref = ref.replace(/^#/, '');\n    }\n\n    return (\n      '<svg class=\"ldi-icon ldi-' + ref + '\"role=\"img\" focusable=\"false\">' +\n      '<use xlink:href=\"#' + ref + '\"></use>' +\n      '</svg>'\n    );\n  },\n\n  addClassToSvg(container, loader) {\n    var svg = container.querySelector('svg');\n\n    if (svg) {\n      L.DomUtil.addClass(svg, loader);\n    }\n  },\n\n  // finds the use element and toggles its icon reference\n  toggleXlink(container, ref1, ref2) {\n    if (!/^#/.test(ref1)) {\n      ref1 = '#' + ref1;\n    }\n    if (!/^#/.test(ref2)) {\n      ref2 = '#' + ref2;\n    }\n\n    var use = container.querySelector('use');\n    if (use) {\n      var toggled = use.getAttribute('xlink:href') === ref1 ? ref2 : ref1;\n      use.setAttribute('xlink:href', toggled);\n      return toggled;\n    }\n    return false;\n  },\n\n  toggleTitle(container, title1, title2) {\n    var toggled = container.getAttribute('title') === title1 ? title2 : title1;\n\n    container.setAttribute('title', toggled);\n    if (container.hasAttribute('aria-label')) {\n      container.setAttribute('aria-label', toggled);\n    }\n    return toggled;\n  },\n};\n","L.ImageUtil = {\n\n  getCmPerPixel(overlay) {\n    var map = overlay._map;\n\n    var dist = map\n        .latLngToLayerPoint(overlay.getCorner(0))\n        .distanceTo(map.latLngToLayerPoint(overlay.getCorner(1)));\n\n    return (dist * 100) / overlay.getElement().width;\n  },\n};\n","L.MatrixUtil = {\n\n  // Compute the adjugate of m\n  adj(m) {\n    return [\n      m[4]*m[8]-m[5]*m[7], m[2]*m[7]-m[1]*m[8], m[1]*m[5]-m[2]*m[4],\n      m[5]*m[6]-m[3]*m[8], m[0]*m[8]-m[2]*m[6], m[2]*m[3]-m[0]*m[5],\n      m[3]*m[7]-m[4]*m[6], m[1]*m[6]-m[0]*m[7], m[0]*m[4]-m[1]*m[3],\n    ];\n  },\n\n  // multiply two 3*3 matrices\n  multmm(a, b) {\n    var c = [];\n    var i;\n\n    for (i = 0; i < 3; i++) {\n      for (var j = 0; j < 3; j++) {\n        var cij = 0;\n\n        for (var k = 0; k < 3; k++) {\n          cij += a[3*i + k]*b[3*k + j];\n        }\n\n        c[3*i + j] = cij;\n      }\n    }\n\n    return c;\n  },\n\n  // multiply a 3*3 matrix and a 3-vector\n  multmv(m, v) {\n    return [\n      m[0]*v[0] + m[1]*v[1] + m[2]*v[2],\n      m[3]*v[0] + m[4]*v[1] + m[5]*v[2],\n      m[6]*v[0] + m[7]*v[1] + m[8]*v[2],\n    ];\n  },\n\n  // multiply a scalar and a 3*3 matrix\n  multsm(s, m) {\n    var matrix = [];\n\n    for (var i = 0, l = m.length; i < l; i++) {\n      matrix.push(s*m[i]);\n    }\n\n    return matrix;\n  },\n\n  basisToPoints(x1, y1, x2, y2, x3, y3, x4, y4) {\n    var m = [\n      x1, x2, x3,\n      y1, y2, y3,\n      1, 1, 1,\n    ];\n    var v = L.MatrixUtil.multmv(L.MatrixUtil.adj(m), [x4, y4, 1]);\n\n    return L.MatrixUtil.multmm(m, [\n      v[0], 0, 0,\n      0, v[1], 0,\n      0, 0, v[2],\n    ]);\n  },\n\n  project(m, x, y) {\n    var v = L.MatrixUtil.multmv(m, [x, y, 1]);\n\n    return [v[0]/v[2], v[1]/v[2]];\n  },\n\n  general2DProjection(\n      x1s, y1s, x1d, y1d,\n      x2s, y2s, x2d, y2d,\n      x3s, y3s, x3d, y3d,\n      x4s, y4s, x4d, y4d\n  ) {\n    var s = L.MatrixUtil.basisToPoints(x1s, y1s, x2s, y2s, x3s, y3s, x4s, y4s);\n    var d = L.MatrixUtil.basisToPoints(x1d, y1d, x2d, y2d, x3d, y3d, x4d, y4d);\n    var m = L.MatrixUtil.multmm(d, L.MatrixUtil.adj(s));\n\n    // Normalize to the unique matrix with m[8] == 1.\n    // See: http://franklinta.com/2014/09/08/computing-css-matrix3d-transforms/\n\n    return L.MatrixUtil.multsm(1/m[8], m);\n  },\n};\n","L.TrigUtil = {\n\n  calcAngle: function(x, y, unit = 'deg') {\n    return unit === 'deg' ?\n        this.radiansToDegrees(Math.atan2(y, x)) :\n        Math.atan2(y, x);\n  },\n\n  radiansToDegrees: function(angle) {\n    return (angle * 180) / Math.PI;\n  },\n\n  degreesToRadians: function(angle) {\n    return (angle * Math.PI) / 180;\n  },\n};\n","L.Utils = {\n  initTranslation: function() {\n    var translation = {\n      deleteImage: 'Delete Image',\n      deleteImages: 'Delete Images',\n      distortImage: 'Distort Image',\n      dragImage: 'Drag Image',\n      exportImage: 'Export Image',\n      exportImages: 'Export Images',\n      removeBorder: 'Remove Border',\n      addBorder: 'Add Border',\n      freeRotateImage: 'Free rotate Image',\n      geolocateImage: 'Geolocate Image',\n      lockMode: 'Lock Mode',\n      lockImages: 'Lock Images',\n      makeImageOpaque: 'Make Image Opaque',\n      makeImageTransparent: 'Make Image Transparent',\n      restoreImage: 'Restore Natural Image',\n      rotateImage: 'Rotate Image',\n      scaleImage: 'Scale Image',\n      stackToFront: 'Stack to Front',\n      stackToBack: 'Stack to Back',\n      unlockImages: 'Unlock Images',\n      confirmImageDelete:\n        'Are you sure? This image will be permanently deleted from the map.',\n      confirmImagesDeletes:\n        'Are you sure? These images will be permanently deleted from the map.',\n    };\n\n    if (!this.options.translation) {\n      this.options.translation = translation;\n    } else {\n      // If the translation for a word is not specified, fallback to English.\n      for (var key in translation) {\n        if (!this.options.translation.hasOwnProperty(key)) {\n          this.options.translation[key] = translation[key];\n        }\n      }\n    }\n\n    L.DomUtil.initTranslation(this.options.translation);\n  },\n\n  getNestedVal: function(obj, key, nestedKey) {\n    var dig = [key, nestedKey];\n    return dig.reduce(function(obj, k) {\n      return obj && obj[k];\n    }, obj);\n  },\n};\n","L.DistortableImageOverlay = L.ImageOverlay.extend({\n\n  options: {\n    height: 200,\n    crossOrigin: true,\n    // todo: find ideal number to prevent distortions during RotateScale, and make it dynamic (remove hardcoding)\n    edgeMinWidth: 50,\n    editable: true,\n    mode: 'distort',\n    selected: false,\n  },\n\n  initialize: function(url, options) {\n    L.setOptions(this, options);\n    L.Utils.initTranslation.call(this);\n\n    this.edgeMinWidth = this.options.edgeMinWidth;\n    this.editable = this.options.editable;\n    this._selected = this.options.selected;\n    this._url = url;\n    this.rotation = {};\n  },\n\n  onAdd: function(map) {\n    this._map = map;\n    if (!this.getElement()) { this._initImage(); }\n\n    map.on('viewreset', this._reset, this);\n\n    if (this.options.corners) {\n      this._corners = this.options.corners;\n      if (map.options.zoomAnimation && L.Browser.any3d) {\n        map.on('zoomanim', this._animateZoom, this);\n      }\n    }\n\n    // Have to wait for the image to load because need to access its w/h\n    L.DomEvent.on(this.getElement(), 'load', () => {\n      this.getPane().appendChild(this.getElement());\n      this._initImageDimensions();\n\n      if (this.options.rotation) {\n        var units = this.options.rotation.deg ? 'deg' : 'rad';\n        this.setAngle(this.options.rotation[units], units);\n      } else {\n        this.rotation = {deg: 0, rad: 0};\n        this._reset();\n      }\n\n      /* Initialize default corners if not already set */\n      if (!this._corners) {\n        if (map.options.zoomAnimation && L.Browser.any3d) {\n          map.on('zoomanim', this._animateZoom, this);\n        }\n      }\n\n      /** if there is a featureGroup, only its editable option matters */\n      var eventParents = this._eventParents;\n      if (eventParents) {\n        this.eP = eventParents[Object.keys(eventParents)[0]];\n        if (this.eP.editable) { this.editing.enable(); }\n      } else {\n        if (this.editable) { this.editing.enable(); }\n        this.eP = null;\n      }\n    });\n\n    L.DomEvent.on(this.getElement(), 'click', this.select, this);\n    L.DomEvent.on(map, {\n      singleclickon: this._singleClickListeners,\n      singleclickoff: this._resetClickListeners,\n      singleclick: this._singleClick,\n    }, this);\n\n    /**\n     * custom events fired from DoubleClickLabels.js. Used to differentiate\n     * single / dblclick to not deselect images on map dblclick.\n     */\n    if (!(map.doubleClickZoom.enabled() || map.doubleClickLabels.enabled())) {\n      L.DomEvent.on(map, 'click', this.deselect, this);\n    }\n\n    this.fire('add');\n  },\n\n  onRemove: function(map) {\n    L.DomEvent.off(this.getElement(), 'click', this.select, this);\n    L.DomEvent.off(map, {\n      singleclickon: this._singleClickListeners,\n      singleclickoff: this._resetClickListeners,\n      singleclick: this._singleClick,\n    }, this);\n    L.DomEvent.off(map, 'click', this.deselect, this);\n\n    if (this.editing) { this.editing.disable(); }\n    this.fire('remove');\n\n    L.ImageOverlay.prototype.onRemove.call(this, map);\n  },\n\n  _initImageDimensions: function() {\n    var map = this._map;\n    var originalImageWidth = L.DomUtil.getStyle(this.getElement(), 'width');\n    var originalImageHeight = L.DomUtil.getStyle(this.getElement(), 'height');\n    var aspectRatio =\n        parseInt(originalImageWidth) / parseInt(originalImageHeight);\n    var imageHeight = this.options.height;\n    var imageWidth = parseInt(aspectRatio * imageHeight);\n    var center = map.project(map.getCenter());\n    var offset = L.point(imageWidth, imageHeight).divideBy(2);\n    if (this.options.corners) {\n      this._corners = this.options.corners;\n    } else {\n      this._corners = [\n        map.unproject(center.subtract(offset)),\n        map.unproject(center.add(L.point(offset.x, -offset.y))),\n        map.unproject(center.add(L.point(-offset.x, offset.y))),\n        map.unproject(center.add(offset)),\n      ];\n    }\n\n    this._initialDimensions = {\n      'center': center,\n      'offset': offset,\n      'zoom': map.getZoom(),\n    };\n\n    this.setBounds(L.latLngBounds(this.getCorners()));\n  },\n\n  _singleClick: function(e) {\n    if (e.type === 'singleclick') { this.deselect(); }\n    else { return; }\n  },\n\n  _singleClickListeners: function() {\n    var map = this._map;\n    L.DomEvent.off(map, 'click', this.deselect, this);\n    L.DomEvent.on(map, 'singleclick', this.deselect, this);\n  },\n\n  _resetClickListeners: function() {\n    var map = this._map;\n    L.DomEvent.on(map, 'click', this.deselect, this);\n    L.DomEvent.off(map, 'singleclick', this.deselect, this);\n  },\n\n  isSelected: function() {\n    return this._selected;\n  },\n\n  deselect: function() {\n    var edit = this.editing;\n    if (!edit.enabled()) { return; }\n\n    edit._removeToolbar();\n    edit._hideMarkers();\n\n    this._selected = false;\n    this.fire('deselect');\n    return this;\n  },\n\n  select: function(e) {\n    var edit = this.editing;\n    var eP = this.eP;\n\n    if (!edit.enabled()) { return; }\n    if (e) { L.DomEvent.stopPropagation(e); }\n\n    // this ensures deselection of all other images, allowing us to keep collection group optional\n    this._programmaticGrouping();\n\n    this._selected = true;\n    edit._addToolbar();\n    edit._showMarkers();\n    this.fire('select');\n\n    // we run the selection logic 1st anyway because the collection group's _addToolbar method depends on it\n    if (eP && eP.anyCollected()) {\n      this.deselect();\n      return;\n    }\n\n    return this;\n  },\n\n  _programmaticGrouping: function() {\n    this._map.eachLayer((layer) => {\n      if (layer instanceof L.DistortableImageOverlay) {\n        layer.deselect();\n      }\n    });\n  },\n\n  setCorner: function(corner, latlng) {\n    var edit = this.editing;\n\n    this._corners[corner] = latlng;\n\n    this.setBounds(L.latLngBounds(this.getCorners()));\n    this.fire('update');\n\n    if (edit.toolbar && edit.toolbar instanceof L.DistortableImage.PopupBar) {\n      edit._updateToolbarPos();\n    }\n\n    this.edited = true;\n\n    return this;\n  },\n\n  _cornerExceedsMapLats: function(zoom, corner, map) {\n    var exceedsTop;\n    var exceedsBottom;\n    if (zoom === 0) {\n      exceedsTop = map.project(corner).y < 2;\n      exceedsBottom = map.project(corner).y >= 255;\n    } else {\n      exceedsTop = map.project(corner).y / zoom < 2;\n      exceedsBottom = map.project(corner).y / Math.pow(2, zoom) >= 255;\n    }\n    return (exceedsTop || exceedsBottom);\n  },\n\n  setCorners: function(latlngObj) {\n    var map = this._map;\n    var zoom = map.getZoom();\n    var edit = this.editing;\n    var i = 0;\n\n    // this is to fix https://github.com/publiclab/Leaflet.DistortableImage/issues/402\n    for (var k in latlngObj) {\n      if (this._cornerExceedsMapLats(zoom, latlngObj[k], map)) {\n        // calling reset / update w/ the same corners bc it prevents a marker flicker for rotate\n        this.setBounds(L.latLngBounds(this.getCorners()));\n        this.fire('update');\n        return;\n      }\n    }\n\n    for (k in latlngObj) {\n      this._corners[i] = latlngObj[k];\n      i += 1;\n    }\n\n    this.setBounds(L.latLngBounds(this.getCorners()));\n    this.fire('update');\n\n    if (edit.toolbar && edit.toolbar instanceof L.DistortableImage.PopupBar) {\n      edit._updateToolbarPos();\n    }\n\n    this.edited = true;\n\n    return this;\n  },\n\n  setCornersFromPoints: function(pointsObj) {\n    var map = this._map;\n    var zoom = map.getZoom();\n    var edit = this.editing;\n    var i = 0;\n\n    for (var k in pointsObj) {\n      var corner = map.layerPointToLatLng(pointsObj[k]);\n\n      if (this._cornerExceedsMapLats(zoom, corner, map)) {\n        // calling reset / update w/ the same corners bc it prevents a marker flicker for rotate\n        this.setBounds(L.latLngBounds(this.getCorners()));\n        this.fire('update');\n        return;\n      }\n    }\n\n    for (k in pointsObj) {\n      this._corners[i] = map.layerPointToLatLng(pointsObj[k]);\n      i += 1;\n    }\n\n    this.setBounds(L.latLngBounds(this.getCorners()));\n    this.fire('update');\n\n    if (edit.toolbar && edit.toolbar instanceof L.DistortableImage.PopupBar) {\n      edit._updateToolbarPos();\n    }\n\n    this.edited = true;\n\n    return this;\n  },\n\n  scaleBy: function(scale) {\n    var map = this._map;\n    var center = map.project(this.getCenter());\n    var i;\n    var p;\n    var scaledCorners = {};\n\n    if (scale === 0) { return; }\n\n    for (i = 0; i < 4; i++) {\n      p = map\n          .project(this.getCorner(i))\n          .subtract(center)\n          .multiplyBy(scale)\n          .add(center);\n      scaledCorners[i] = map.unproject(p);\n    }\n\n    this.setCorners(scaledCorners);\n\n    return this;\n  },\n\n  getAngle: function(unit = 'deg') {\n    var matrix = this.getElement().style[L.DomUtil.TRANSFORM]\n        .split('matrix3d')[1]\n        .slice(1, -1)\n        .split(',');\n\n    var row0x = matrix[0];\n    var row0y = matrix[1];\n    var row1x = matrix[4];\n    var row1y = matrix[5];\n\n    var determinant = row0x * row1y - row0y * row1x;\n\n    var angle = L.TrigUtil.calcAngle(row0x, row0y, 'rad');\n\n    if (determinant < 0) {\n      angle += angle < 0 ? Math.PI : -Math.PI;\n    }\n\n    if (angle < 0) {\n      angle = 2 * Math.PI + angle;\n    }\n\n    return unit === 'deg' ?\n        Math.round(L.TrigUtil.radiansToDegrees(angle)) :\n        L.Util.formatNum(angle, 2);\n  },\n\n  setAngle: function(angle, unit = 'deg') {\n    var currentAngle = this.getAngle(unit);\n    var angleToRotateBy = angle - currentAngle;\n    this.rotateBy(angleToRotateBy, unit);\n\n    return this;\n  },\n\n  rotateBy: function(angle, unit = 'deg') {\n    var map = this._map;\n    var center = map.project(this.getCenter());\n    var corners = {};\n    var i;\n    var p;\n    var q;\n\n    if (unit === 'deg') {\n      angle = L.TrigUtil.degreesToRadians(angle);\n    }\n\n    for (i = 0; i < 4; i++) {\n      p = map.project(this.getCorner(i)).subtract(center);\n      q = L.point(\n          Math.cos(angle) * p.x - Math.sin(angle) * p.y,\n          Math.sin(angle) * p.x + Math.cos(angle) * p.y\n      );\n      corners[i] = map.unproject(q.add(center));\n    }\n\n    this.setCorners(corners);\n\n    return this;\n  },\n\n  dragBy: function(formerPoint, newPoint) {\n    var map = this._map;\n    var i;\n    var p;\n    var transCorners = {};\n    var delta = map.project(formerPoint).subtract(map.project(newPoint));\n\n    for (i = 0; i < 4; i++) {\n      p = map.project(this.getCorner(i)).subtract(delta);\n      transCorners[i] = map.unproject(p);\n    }\n\n    this.setCorners(transCorners);\n  },\n\n  restore: function() {\n    var map = this._map;\n    var center = this._initialDimensions.center;\n    var offset = this._initialDimensions.offset;\n    var zoom = this._initialDimensions.zoom;\n    var corners = [\n      center.subtract(offset),\n      center.add(L.point(offset.x, -offset.y)),\n      center.add(L.point(-offset.x, offset.y)),\n      center.add(offset),\n    ];\n\n    for (var i = 0; i < 4; i++) {\n      if (!map.unproject(corners[i], zoom).equals(this.getCorner(i))) {\n        this.setCorner(i, map.unproject(corners[i], zoom));\n      }\n    }\n\n    this.edited = false;\n    this.fire('restore');\n\n    return this;\n  },\n\n  /* Copied from Leaflet v0.7 https://github.com/Leaflet/Leaflet/blob/66282f14bcb180ec87d9818d9f3c9f75afd01b30/src/dom/DomUtil.js#L189-L199 */\n  /* since L.DomUtil.getTranslateString() is deprecated in Leaflet v1.0 */\n  _getTranslateString: function(point) {\n    // on WebKit browsers (Chrome/Safari/iOS Safari/Android)\n    // using translate3d instead of translate\n    // makes animation smoother as it ensures HW accel is used.\n    // Firefox 13 doesn't care\n    // (same speed either way), Opera 12 doesn't support translate3d\n\n    var is3d = L.Browser.webkit3d;\n    var open = 'translate' + (is3d ? '3d' : '') + '(';\n    var close = (is3d ? ',0' : '') + ')';\n\n    return open + point.x + 'px,' + point.y + 'px' + close;\n  },\n\n  _reset: function() {\n    var map = this._map;\n    var image = this.getElement();\n    var latLngToLayerPoint = L.bind(map.latLngToLayerPoint, map);\n    var transformMatrix = this\n        ._calculateProjectiveTransform(latLngToLayerPoint);\n    var topLeft = latLngToLayerPoint(this.getCorner(0));\n    var warp = L.DomUtil.getMatrixString(transformMatrix);\n    var translation = this._getTranslateString(topLeft);\n\n    /* See L.DomUtil.setPosition. Mainly for the purposes of L.Draggable. */\n    image._leaflet_pos = topLeft;\n\n    image.style[L.DomUtil.TRANSFORM] = [translation, warp].join(' ');\n\n    /* Set origin to the upper-left corner rather than\n     * the center of the image, which is the default.\n     */\n    image.style[L.DomUtil.TRANSFORM + '-origin'] = '0 0 0';\n\n    this.rotation.deg = this.getAngle();\n    this.rotation.rad = this.getAngle('rad');\n  },\n\n  /*\n   * Calculates the transform string that will be\n   * correct *at the end* of zooming.\n   * Leaflet then generates a CSS3 animation between the current transform and\n   * future transform which makes the transition appear smooth.\n   */\n  _animateZoom: function(event) {\n    var map = this._map;\n    var image = this.getElement();\n    var latLngToNewLayerPoint = function(latlng) {\n      return map._latLngToNewLayerPoint(latlng, event.zoom, event.center);\n    };\n    var transformMatrix = this._calculateProjectiveTransform(\n        latLngToNewLayerPoint\n    );\n    var topLeft = latLngToNewLayerPoint(this.getCorner(0));\n    var warp = L.DomUtil.getMatrixString(transformMatrix);\n    var translation = this._getTranslateString(topLeft);\n\n    /* See L.DomUtil.setPosition. Mainly for the purposes of L.Draggable. */\n    image._leaflet_pos = topLeft;\n\n    image.style[L.DomUtil.TRANSFORM] = [translation, warp].join(' ');\n  },\n\n  getCorners: function() {\n    return this._corners;\n  },\n\n  getCorner: function(i) {\n    return this._corners[i];\n  },\n\n  // image (vertex) centroid calculation\n  getCenter: function() {\n    var map = this._map;\n    var reduce = this.getCorners().reduce(function(agg, corner) {\n      return agg.add(map.project(corner));\n    }, L.point(0, 0));\n    return map.unproject(reduce.divideBy(4));\n  },\n\n  _calculateProjectiveTransform: function(latLngToCartesian) {\n    /* Setting reasonable but made-up image defaults\n     * allow us to place images on the map before\n     * they've finished downloading. */\n    var offset = latLngToCartesian(this.getCorner(0));\n    var w = this.getElement().offsetWidth || 500;\n    var h = this.getElement().offsetHeight || 375;\n    var c = [];\n    var j;\n    /* Convert corners to container points (i.e. cartesian coordinates). */\n    for (j = 0; j < 4; j++) {\n      c.push(latLngToCartesian(this.getCorner(j))._subtract(offset));\n    }\n\n    /*\n     * This matrix describes the action of\n     * the CSS transform on each corner of the image.\n     * It maps from the coordinate system centered\n     * at the upper left corner of the image\n     * to the region bounded by the latlngs in this._corners.\n     * For example:\n     * 0, 0, c[0].x, c[0].y\n     * says that the upper-left corner of the image\n     * maps to the first latlng in this._corners.\n     */\n    return L.MatrixUtil.general2DProjection(\n        0, 0, c[0].x, c[0].y,\n        w, 0, c[1].x, c[1].y,\n        0, h, c[2].x, c[2].y,\n        w, h, c[3].x, c[3].y\n    );\n  },\n});\n\nL.distortableImageOverlay = function(id, options) {\n  return new L.DistortableImageOverlay(id, options);\n};\n\nL.Map.addInitHook(function() {\n  if (!L.DomUtil.hasClass(this.getContainer(), 'ldi')) {\n    L.DomUtil.addClass(this.getContainer(), 'ldi');\n  }\n});\n","L.DistortableCollection = L.FeatureGroup.extend({\n  options: {\n    editable: true,\n    exportOpts: {\n      exportStartUrl: '//export.mapknitter.org/export',\n      statusUrl: '//export.mapknitter.org',\n      exportUrl: 'http://export.mapknitter.org/',\n    },\n  },\n\n  initialize: function(options) {\n    L.setOptions(this, options);\n    L.FeatureGroup.prototype.initialize.call(this, options);\n    L.Utils.initTranslation.call(this);\n\n    this.editable = this.options.editable;\n  },\n\n  onAdd: function(map) {\n    L.FeatureGroup.prototype.onAdd.call(this, map);\n\n    this._map = map;\n\n    if (this.editable) { this.editing.enable(); }\n\n    /**\n     * although we have a DistortableCollection.Edit class that handles collection events to keep our code managable,\n     * events that need to be added on individual images are kept here to do so through `layeradd`.\n     */\n    this.on('layeradd', this._addEvents, this);\n    this.on('layerremove', this._removeEvents, this);\n  },\n\n  onRemove: function() {\n    if (this.editing) { this.editing.disable(); }\n\n    this.off('layeradd', this._addEvents, this);\n    this.off('layerremove', this._removeEvents, this);\n  },\n\n  _addEvents: function(e) {\n    var layer = e.layer;\n\n    L.DomEvent.on(layer, {\n      dragstart: this._dragStartMultiple,\n      drag: this._dragMultiple,\n    }, this);\n\n    L.DomEvent.on(layer.getElement(), {\n      mousedown: this._deselectOthers,\n      /* Enable longpress for multi select for touch devices. */\n      contextmenu: this._longPressMultiSelect,\n    }, this);\n  },\n\n  _removeEvents: function(e) {\n    var layer = e.layer;\n\n    L.DomEvent.off(layer, {\n      dragstart: this._dragStartMultiple,\n      drag: this._dragMultiple,\n    }, this);\n\n    L.DomEvent.off(layer.getElement(), {\n      mousedown: this._deselectOthers,\n      contextmenu: this._longPressMultiSelect,\n    }, this);\n  },\n\n  _longPressMultiSelect: function(e) {\n    if (!this.editable) { return; }\n\n    e.preventDefault();\n\n    this.eachLayer((layer) => {\n      var edit = layer.editing;\n      if (layer.getElement() === e.target && edit.enabled()) {\n        L.DomUtil.toggleClass(layer.getElement(), 'collected');\n        if (this.anyCollected()) {\n          layer.deselect();\n          this.editing._addToolbar();\n        } else {\n          this.editing._removeToolbar();\n        }\n      }\n    });\n  },\n\n  isCollected: function(overlay) {\n    return L.DomUtil.hasClass(overlay.getElement(), 'collected');\n  },\n\n  anyCollected: function() {\n    var layerArr = this.getLayers();\n    return layerArr.some(this.isCollected.bind(this));\n  },\n\n  _toggleCollected: function(e, layer) {\n    if (e.shiftKey) {\n      /* conditional prevents disabled images from flickering multi-select mode */\n      if (layer.editing.enabled()) {\n        L.DomUtil.toggleClass(e.target, 'collected');\n      }\n    }\n\n    if (this.anyCollected()) { layer.deselect(); }\n    else { this.editing._removeToolbar(); }\n  },\n\n  _deselectOthers: function(e) {\n    if (!this.editable) { return; }\n\n    this.eachLayer((layer) => {\n      if (layer.getElement() !== e.target) {\n        layer.deselect();\n      } else {\n        this._toggleCollected(e, layer);\n      }\n    });\n\n    if (e) { L.DomEvent.stopPropagation(e); }\n  },\n\n  _dragStartMultiple: function(e) {\n    var overlay = e.target;\n    var map = this._map;\n    var i;\n\n    if (!this.isCollected(overlay)) { return; }\n\n    this.eachLayer((layer) => {\n      layer._dragStartPoints = {};\n      layer.deselect();\n      for (i = 0; i < 4; i++) {\n        var c = layer.getCorner(i);\n        layer._dragStartPoints[i] = map.latLngToLayerPoint(c);\n      }\n    });\n  },\n\n  _dragMultiple: function(e) {\n    var overlay = e.target;\n    var map = this._map;\n\n    if (!this.isCollected(overlay)) { return; }\n\n    var topLeft = map.latLngToLayerPoint(overlay.getCorner(0));\n    var delta = overlay._dragStartPoints[0].subtract(topLeft);\n\n    this._updateCollectionFromPoints(delta, overlay);\n  },\n\n  _toRemove: function() {\n    var layerArr = this.getLayers();\n\n    return layerArr.filter((layer) => {\n      var mode = layer.editing._mode;\n      return (this.isCollected(layer) && mode !== 'lock');\n    });\n  },\n\n  _toMove: function(overlay) {\n    var layerArr = this.getLayers();\n\n    return layerArr.filter((layer) => {\n      var mode = layer.editing._mode;\n      return layer !== overlay && this.isCollected(layer) && mode !== 'lock';\n    });\n  },\n\n  _updateCollectionFromPoints: function(delta, overlay) {\n    var layersToMove = this._toMove(overlay);\n    var p = new L.Transformation(1, -delta.x, 1, -delta.y);\n    var i;\n\n    layersToMove.forEach((layer) => {\n      var movedPoints = {};\n      for (i = 0; i < 4; i++) {\n        movedPoints[i] = p.transform(layer._dragStartPoints[i]);\n      }\n      layer.setCornersFromPoints(movedPoints);\n    });\n  },\n\n  _getAvgCmPerPixel: function(imgs) {\n    var reduce = imgs.reduce(function(sum, img) {\n      return sum + img.cm_per_pixel;\n    }, 0);\n    return reduce / imgs.length;\n  },\n\n  generateExportJson: function() {\n    var json = {};\n    json.images = [];\n\n    this.eachLayer(function(layer) {\n      if (this.isCollected(layer)) {\n        var sections = layer._image.src.split('/');\n        var filename = sections[sections.length-1];\n        var zc = layer.getCorners();\n        var corners = [\n          {lat: zc[0].lat, lon: zc[0].lng},\n          {lat: zc[1].lat, lon: zc[1].lng},\n          {lat: zc[3].lat, lon: zc[3].lng},\n          {lat: zc[2].lat, lon: zc[2].lng},\n        ];\n        json.images.push({\n          id: this.getLayerId(layer),\n          src: layer._image.src,\n          width: layer._image.width,\n          height: layer._image.height,\n          image_file_name: filename,\n          nodes: corners,\n          cm_per_pixel: L.ImageUtil.getCmPerPixel(layer),\n        });\n      }\n    }, this);\n\n    json.images = json.images.reverse();\n    json.avg_cm_per_pixel = this._getAvgCmPerPixel(json.images);\n\n    return json;\n  },\n});\n\nL.distortableCollection = function(id, options) {\n  return new L.DistortableCollection(id, options);\n};\n","/* eslint-disable no-unused-vars */\nL.EXIF = function getEXIFdata(img) {\n  if (Object.keys(EXIF.getAllTags(img)).length !== 0) {\n    console.log(EXIF.getAllTags(img));\n    var GPS = EXIF.getAllTags(img);\n    var altitude;\n\n    /* If the lat/lng is available. */\n    if (\n      typeof GPS.GPSLatitude !== 'undefined' &&\n      typeof GPS.GPSLongitude !== 'undefined'\n    ) {\n      // sadly, encoded in [degrees,minutes,seconds]\n      // primitive value = GPS.GPSLatitude[x].numerator\n      var lat =\n        GPS.GPSLatitude[0] +\n        GPS.GPSLatitude[1] / 60 +\n        GPS.GPSLatitude[2] / 3600;\n      var lng =\n        GPS.GPSLongitude[0] +\n        GPS.GPSLongitude[1] / 60 +\n        GPS.GPSLongitude[2] / 3600;\n\n      if (GPS.GPSLatitudeRef !== 'N') {\n        lat = lat * -1;\n      }\n      if (GPS.GPSLongitudeRef === 'W') {\n        lng = lng * -1;\n      }\n    }\n\n    // Attempt to use GPS compass heading; will require\n    // some trig to calc corner points, which you can find below:\n\n    var angle = 0;\n    // \"T\" refers to \"True north\", so -90.\n    if (GPS.GPSImgDirectionRef === 'T') {\n      angle =\n        (Math.PI / 180) *\n        (GPS.GPSImgDirection.numerator / GPS.GPSImgDirection.denominator - 90);\n      // \"M\" refers to \"Magnetic north\"\n    } else if (GPS.GPSImgDirectionRef === 'M') {\n      angle =\n        (Math.PI / 180) *\n        (GPS.GPSImgDirection.numerator / GPS.GPSImgDirection.denominator - 90);\n    } else {\n      console.log('No compass data found');\n    }\n\n    console.log('Orientation:', GPS.Orientation);\n\n    /* If there is orientation data -- i.e. landscape/portrait etc */\n    if (GPS.Orientation === 6) {\n      // CCW\n      angle += (Math.PI / 180) * -90;\n    } else if (GPS.Orientation === 8) {\n      // CW\n      angle += (Math.PI / 180) * 90;\n    } else if (GPS.Orientation === 3) {\n      // 180\n      angle += (Math.PI / 180) * 180;\n    }\n\n    /* If there is altitude data */\n    if (\n      typeof GPS.GPSAltitude !== 'undefined' &&\n      typeof GPS.GPSAltitudeRef !== 'undefined'\n    ) {\n      // Attempt to use GPS altitude:\n      // (may eventually need to find EXIF field of view for correction)\n      if (\n        typeof GPS.GPSAltitude !== 'undefined' &&\n        typeof GPS.GPSAltitudeRef !== 'undefined'\n      ) {\n        altitude =\n          GPS.GPSAltitude.numerator / GPS.GPSAltitude.denominator +\n          GPS.GPSAltitudeRef;\n      } else {\n        altitude = 0; // none\n      }\n    }\n  } else {\n    alert('EXIF initialized. Press again to view data in console.');\n  }\n};\n","L.EditHandle = L.Marker.extend({\n  initialize: function(overlay, corner, options) {\n    var latlng = overlay.getCorner(corner);\n\n    L.setOptions(this, options);\n\n    this._handled = overlay;\n    this._corner = corner;\n\n    var markerOptions = {\n      draggable: true,\n      zIndexOffset: 10,\n    };\n\n    if (options && options.hasOwnProperty('draggable')) {\n      markerOptions.draggable = options.draggable;\n    }\n\n    L.Marker.prototype.initialize.call(this, latlng, markerOptions);\n  },\n\n  onAdd: function(map) {\n    L.Marker.prototype.onAdd.call(this, map);\n    this._bindListeners();\n    this.updateHandle();\n  },\n\n  onRemove: function(map) {\n    this._unbindListeners();\n    L.Marker.prototype.onRemove.call(this, map);\n  },\n\n  _onHandleDragStart: function() {\n    this._handled.fire('editstart');\n  },\n\n  _onHandleDragEnd: function() {\n    this._fireEdit();\n  },\n\n  _fireEdit: function() {\n    this._handled.edited = true;\n    this._handled.fire('edit');\n  },\n\n  _bindListeners: function() {\n    this.on({\n      contextmenu: L.DomEvent.stop,\n      dragstart: this._onHandleDragStart,\n      drag: this._onHandleDrag,\n      dragend: this._onHandleDragEnd,\n    }, this);\n\n    this._handled._map.on('zoomend', this.updateHandle, this);\n    this._handled.on('update', this.updateHandle, this);\n  },\n\n  _unbindListeners: function() {\n    this.off({\n      contextmenu: L.DomEvent.stop,\n      dragstart: this._onHandleDragStart,\n      drag: this._onHandleDrag,\n      dragend: this._onHandleDragEnd,\n    }, this);\n\n    this._handled._map.off('zoomend', this.updateHandle, this);\n    this._handled.off('update', this.updateHandle, this);\n  },\n\n  /* Takes two latlngs and calculates the scaling difference. */\n  _calculateScalingFactor: function(latlngA, latlngB) {\n    var overlay = this._handled;\n    var map = overlay._map;\n\n    var centerPoint = map.latLngToLayerPoint(overlay.getCenter());\n    var formerPoint = map.latLngToLayerPoint(latlngA);\n    var newPoint = map.latLngToLayerPoint(latlngB);\n    var formerRadiusSquared = this._d2(centerPoint, formerPoint);\n    var newRadiusSquared = this._d2(centerPoint, newPoint);\n\n    return Math.sqrt(newRadiusSquared / formerRadiusSquared);\n  },\n\n  /* Distance between two points in cartesian space, squared (distance formula). */\n  _d2: function(a, b) {\n    var dx = a.x - b.x;\n    var dy = a.y - b.y;\n\n    return Math.pow(dx, 2) + Math.pow(dy, 2);\n  },\n\n  /* Takes two latlngs and calculates the angle between them. */\n  calculateAngleDelta: function(latlngA, latlngB) {\n    var overlay = this._handled;\n    var map = overlay._map;\n\n    var centerPoint = map.latLngToLayerPoint(overlay.getCenter());\n    var formerPoint = map.latLngToLayerPoint(latlngA);\n    var newPoint = map.latLngToLayerPoint(latlngB);\n\n    var initialAngle = (\n      Math.atan2(centerPoint.y - formerPoint.y, centerPoint.x - formerPoint.x)\n    );\n    var newAngle = (\n      Math.atan2(centerPoint.y - newPoint.y, centerPoint.x - newPoint.x)\n    );\n\n    return newAngle - initialAngle;\n  },\n});\n","L.DistortHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'distort',\n    icon: L.icon({\n      iconUrl:\n        // eslint-disable-next-line max-len\n        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAklEQVR4AewaftIAAAChSURBVO3BIU4DURgGwNkvL2B6AkQTLBqP4QCoSm7DDXoBLBZHDbfgICAIZjEV3YTn9uVHdMZZtcnCfI13bIzxg0emg6Nm6QVbYz3jylEsXRrvwommb49X67jFkz80fR9Mb1YxTzqiWBSLYlEsikWxKBbFolgUi2JRLIpFsSgWxaJY03fHHOu40dH07bAzWCx9Ge/TiWbpHgdsjPGNB2f/yS+7xRCyiiZPJQAAAABJRU5ErkJggg==',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    var overlay = this._handled;\n\n    overlay.setCorner(this._corner, this.getLatLng());\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.distortHandle = function(overlay, idx, options) {\n  return new L.DistortHandle(overlay, idx, options);\n};\n","L.DragHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'drag',\n    icon: L.icon({\n      // eslint-disable-next-line max-len\n      iconUrl: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAsVJREFUeNrMVztLXEEUvnNVFAVBAhY2aRKbTZEHJNpYabuNjSgYg/GxdsmPSJkUAa/ZdVEX8mgWYVutbHxAHkVskjQBuUUgBISVhCQk3wnfwMlk1rusN1wHPubOzJlzvjlz5sxc01Ma/hUEwQnwDIjqc7uvgv9YYO86qgIwCXQbdNTlQ8kcCBHgBch8TcloF6oJGr6phk6EQAkfdz3zvgDr9Mr7Fg1fptEZoM8jsmrokpfsiIFO4IIjuE2v1EDmR4LRdlR5Gh51hj8D34ABtm8YTtqna0TgklIw5CgQguKxIojEjmFROg/MKQO27NkFAB+4wAPouGUJiIvWKHwbAxX2XyWRKWkqhT+pbJntJZJuUzISW0+5hW+obxrVBsfvoH/dqCCJuU97GBh2VteLSiYvArmErT8EVoAK9Bw7enbpVYmvAQlyowYforrH5jXL2rPHI/TKONDB7u9AlavdaTBPvPmazUeQuy8f7UomUgTEwIJPEQ3sQGE/6ll2l9H/KcEzBcfWn2IclluM3DpddJxSHujlFkscbUPvmB0LHVnLrId7nlaZVkEc6QGXQI1MAwZcWmVRHeNaQwJMMiU2cwy4s7p/RJ2ckpvIQs+cIs+5GzitloLKHUV3MPREuXbTOKO91dX387gGTONxIgEWm+E61FFrpcyqXLHsEwiDjEsjAksqw5XPoL9MHVrn6QR4q+XZrDaR4RoWzq2ymafuRA/Mq1stSsHLVkcbdf9VjOcx8ZH3+SFWcCWlVPyWuUBOwUWdC1wP5NVjYiXFWLO69PZ6CRTUY6KSIoEKdf6T3IzzgHxnsyHctNBEkmn6Oob8ExUDg/ahGybd177cDjzH5xHwgDiSvoS7I/LZyvxJZj0wod7tkX5G0XVC7rEyLhfLJjBGbKoLLEfZWObyKeZ6oY82g+yf5Zn/mJyHX7PMf04z/T3/LcAAu4E6iiyJqf0AAAAASUVORK5CYII=',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    var overlay = this._handled;\n    var formerLatLng = overlay.getCorner(this._corner);\n    var newLatLng = this.getLatLng();\n\n    overlay.dragBy(formerLatLng, newLatLng);\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.dragHandle = function(overlay, idx, options) {\n  return new L.DragHandle(overlay, idx, options);\n};\n","L.FreeRotateHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'freeRotate',\n    icon: L.icon({\n      iconUrl:\n        // eslint-disable-next-line max-len\n        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAklEQVR4AewaftIAAAHiSURBVMXBa3HbShgA0PMp/1sCCo8oCEpgTaCXgIXAJiDzyCJoAUTm4UVQAns1Y8+snWnTvJyeE16hkjDgDrfoNTMKcpC9UPiLSo8JyetkjEHxjPCMyoS199kFoz8Iv1HpMaN3qWDCHoegOKkkRwnJpRmroHgiPFEZ8IBekzEGxQtUEhKSS/fB7Ew4U+lxcGkVZG9QWWPSFAxBcdK59KApuA+yNwp2uEdx1GN25sZJZULSfAtm77SlbNjju6MvG75u+WHRWVR6rDVjMPsgwYyVZl3pLTpHkyYHOx8syMiayaJzlDTZ9YyaZNFVkiYH2ZUEBcVJJXVImuz6Js3Qofe59pq7DoOTILu+g+a288mCouk7/1iH4qTS+2QdDppbV1ZJmrnDXnPnc5UOs2Z0fUmTuyBr+krvSioJyUmQO0dZM7mepMkWnaNRkyrJB6uskTSjxY3Fll8bvmJwlDb83FJ8gMqAB80uyBY3Trb82PAfvjj6vuHnluIdKgMeNXOwctK5NKBoHitrb1RJeHRp5Ux4ojLg0aWMHGQvUOkxIWkKVsHsTPiNSo8HDC5lZIsgO6n0uMUdRvQuFQxB8UR4RmXC2vvsgtEfhL+o9JiQvE7GGBTPCK9QSUjoMWgKDthjDrIX+h/k0I7gth6N5gAAAABJRU5ErkJggg==',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    const overlay = this._handled;\n    const map = overlay._map;\n    const formerLatLng = overlay.getCorner(this._corner);\n    const newLatLng = this.getLatLng();\n    const angle = this.calculateAngleDelta(formerLatLng, newLatLng);\n    const scale = this._calculateScalingFactor(formerLatLng, newLatLng);\n\n    if (angle !== 0) { overlay.rotateBy(angle, 'rad'); }\n\n    let edgeMinWidth = overlay.edgeMinWidth;\n    if (!edgeMinWidth) { edgeMinWidth = 50; } /* just in case */\n\n    const corner1 = map.latLngToContainerPoint(overlay.getCorner(0));\n    const corner2 = map.latLngToContainerPoint(overlay.getCorner(1));\n    const w = Math.abs(corner1.x - corner2.x);\n    const h = Math.abs(corner1.y - corner2.y);\n    const distance = Math.sqrt(w * w + h * h);\n    if (distance > edgeMinWidth || scale > 1) {\n      overlay.scaleBy(scale);\n    } else {\n      overlay.scaleBy(1);\n    }\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.freeRotateHandle = (overlay, idx, options) => {\n  return new L.FreeRotateHandle(overlay, idx, options);\n};\n","L.LockHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'lock',\n    interactive: false,\n    icon: L.icon({\n      // eslint-disable-next-line max-len\n      iconUrl: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAklEQVR4AewaftIAAAD8SURBVO3BPU7CYAAA0AdfjIcQlRCQBG7C3gk2uIPG2RC3Dk16Gz0FTO1WZs/gwGCMP/2+xsSl7+n1er1Iz9LtRQjaPeMeO+TinLDCJV78YqjdA04YodKuxhUaPGoRxMmxwRQZSt87Yo4KExGCeAUyLLFB4bMacxywEClIU2KDKXbInTUYo8JCgoFuGoxQO5uiwY1EA91VmDqrcKeDoX8WdNNgjApvmGGLXKIgXY0xGkxQYItrrFFIEKQ5Yo4KEx9yrDFDhlKkIF6NOQ5Y+KpAhiXWKEQI4pxwiwoLPyuxwQw75FoE7fZYocFEuwI7jHCBV39gL92TXq/Xi/AOcmczZmaIMScAAAAASUVORK5CYII=',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  onRemove: function(map) {\n    this.unbindTooltip();\n    L.EditHandle.prototype.onRemove.call(this, map);\n  },\n\n  _bindListeners: function() {\n    var icon = this.getElement();\n\n    L.EditHandle.prototype._bindListeners.call(this);\n\n    L.DomEvent.on(icon, {\n      mousedown: this._tooltipOn,\n      mouseup: this._tooltipOff,\n    }, this);\n\n    L.DomEvent.on(document, 'pointerleave', this._tooltipOff, this);\n  },\n\n  _unbindListeners: function() {\n    var icon = this.getElement();\n\n    L.EditHandle.prototype._bindListeners.call(this);\n\n    L.DomEvent.off(icon, {\n      mousedown: this._tooltipOn,\n      mouseup: this._tooltipOff,\n    }, this);\n\n    L.DomEvent.off(document, 'pointerleave', this._tooltipOff, this);\n  },\n\n  /* cannot be dragged */\n  _onHandleDrag: function() {\n  },\n\n  updateHandle: function() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n\n  _tooltipOn: function(e) {\n    var eP = this._handled.parentGroup;\n    var edit = eP ? eP.editing : this._handled.editing;\n\n    if (e.shiftKey) { return; }\n    if (!this._handled.isSelected() && (eP && !eP.isCollected(this._handled))) {\n      return;\n    }\n\n    var handlesArr = edit._lockHandles;\n\n    this._timer = setTimeout(L.bind(function() {\n      if (this._timeout) { clearTimeout(this._timeout); }\n\n      if (!this.getTooltip()) {\n        this.bindTooltip('Locked!', {permanent: true});\n      } else {\n        handlesArr.eachLayer(function(handle) {\n          if (this !== handle) { handle.closeTooltip(); }\n        });\n      }\n\n      this.openTooltip();\n    }, this), 500);\n  },\n\n  _tooltipOff: function(e) {\n    var eP = this._handled.parentGroup;\n    var edit = eP ? eP.editing : this._handled.editing;\n\n    if (e.shiftKey) { return; }\n    if (!this._handled.isSelected() && (eP && !eP.isCollected(this._handled))) {\n      return;\n    }\n\n    var handlesArr = edit._lockHandles;\n\n    if (e.currentTarget === document) {\n      handlesArr.eachLayer(function(handle) {\n        handle.closeTooltip();\n      });\n    }\n\n    if (this._timer) { clearTimeout(this._timer); }\n\n    this._timeout = setTimeout(L.bind(function() {\n      this.closeTooltip();\n    }, this), 400);\n  },\n});\n\nL.lockHandle = function(overlay, idx, options) {\n  return new L.LockHandle(overlay, idx, options);\n};\n","L.RotateHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'rotate',\n    icon: L.icon({\n      iconUrl:\n        // eslint-disable-next-line max-len\n        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAklEQVR4AewaftIAAAHiSURBVMXBa3HbShgA0PMp/1sCCo8oCEpgTaCXgIXAJiDzyCJoAUTm4UVQAns1Y8+snWnTvJyeE16hkjDgDrfoNTMKcpC9UPiLSo8JyetkjEHxjPCMyoS199kFoz8Iv1HpMaN3qWDCHoegOKkkRwnJpRmroHgiPFEZ8IBekzEGxQtUEhKSS/fB7Ew4U+lxcGkVZG9QWWPSFAxBcdK59KApuA+yNwp2uEdx1GN25sZJZULSfAtm77SlbNjju6MvG75u+WHRWVR6rDVjMPsgwYyVZl3pLTpHkyYHOx8syMiayaJzlDTZ9YyaZNFVkiYH2ZUEBcVJJXVImuz6Js3Qofe59pq7DoOTILu+g+a288mCouk7/1iH4qTS+2QdDppbV1ZJmrnDXnPnc5UOs2Z0fUmTuyBr+krvSioJyUmQO0dZM7mepMkWnaNRkyrJB6uskTSjxY3Fll8bvmJwlDb83FJ8gMqAB80uyBY3Trb82PAfvjj6vuHnluIdKgMeNXOwctK5NKBoHitrb1RJeHRp5Ux4ojLg0aWMHGQvUOkxIWkKVsHsTPiNSo8HDC5lZIsgO6n0uMUdRvQuFQxB8UR4RmXC2vvsgtEfhL+o9JiQvE7GGBTPCK9QSUjoMWgKDthjDrIX+h/k0I7gth6N5gAAAABJRU5ErkJggg==',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    var overlay = this._handled;\n    var formerLatLng = overlay.getCorner(this._corner);\n    var newLatLng = this.getLatLng();\n    var angle = this.calculateAngleDelta(formerLatLng, newLatLng);\n\n    /*\n     * running rotation logic even for an angle delta of 0\n     * prevents a small, occasional marker flicker\n     */\n    overlay.rotateBy(angle, 'rad');\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.rotateHandle = function(overlay, idx, options) {\n  return new L.RotateHandle(overlay, idx, options);\n};\n","L.ScaleHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'scale',\n    icon: L.icon({\n      iconUrl:\n        // eslint-disable-next-line max-len\n        'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI0NTkiIGhlaWdodD0iNDY0IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA1MTIgNTEyIiB4bWw6c3BhY2U9InByZXNlcnZlIiBzdHlsZT0iIj48cmVjdCBpZD0iYmFja2dyb3VuZHJlY3QiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHg9IjAiIHk9IjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIgY2xhc3M9IiIgc3R5bGU9IiIvPjxnIGNsYXNzPSJjdXJyZW50TGF5ZXIiIHN0eWxlPSIiPjx0aXRsZT5MYXllciAxPC90aXRsZT48cGF0aCBkPSJNNDU5LjA0OTE1OTUzMDQ3MTM0LDg2LjkyNjIzNDUxMjU1MDAyIFYwIGgtODUuNzE0NTczMzU2MzEyMDkgdjI3LjA0MzcxNzQwMzkwNDQ1MiBIODUuNzE0NTczMzU2MzEyMDMgVjAgSDAgdjg2LjkyNjIzNDUxMjU1MDAyIGgyNS43MTQzNzIwMDY4OTM2MjYgdjI4OS43NTQxMTUwNDE4MzM0IEgwIHY4Ni45MjYyMzQ1MTI1NTAwMiBoODUuNzE0NTczMzU2MzEyMDkgdi0yNy4wNDM3MTc0MDM5MDQ0NTIgaDI4NS43MTUyNDQ1MjEwNDAzIHYyNy4wNDM3MTc0MDM5MDQ0NTIgaDg1LjcxNDU3MzM1NjMxMjA5IHYtODYuOTI2MjM0NTEyNTUwMDIgaC0yMy44MDk2MDM3MTAwODY2OSBWODYuOTI2MjM0NTEyNTUwMDIgSDQ1OS4wNDkxNTk1MzA0NzEzNCB6TTM4NC43NjMxOTU5NTUwMDA5LDEyLjU1NjAxMTY1MTgxMjc4MSBoNjEuOTA0OTY5NjQ2MjI1Mzk2IHY2Mi43ODAwNTgyNTkwNjM5MSBoLTYxLjkwNDk2OTY0NjIyNTM5NiBWMTIuNTU2MDExNjUxODEyNzgxIHpNMTIuMzgwOTkzOTI5MjQ1MDUsMTIuNTU2MDExNjUxODEyNzgxIGg2MS45MDQ5Njk2NDYyMjUzOTYgdjYyLjc4MDA1ODI1OTA2MzkxIEgxMi4zODA5OTM5MjkyNDUwNSBWMTIuNTU2MDExNjUxODEyNzgxIHpNNzQuMjg1OTYzNTc1NDcwNTMsNDUxLjA1MDU3MjQxNTEyMDY2IEgxMi4zODA5OTM5MjkyNDUwNSB2LTYyLjc4MDA1ODI1OTA2MzkxIGg2MS45MDQ5Njk2NDYyMjUzOTYgVjQ1MS4wNTA1NzI0MTUxMjA2NiB6TTQ0NS43MTU3ODE0NTI4MjI3NCw0NTEuMDUwNTcyNDE1MTIwNjYgaC02Mi44NTczNTM3OTQ2Mjg4NjQgdi02Mi43ODAwNTgyNTkwNjM5MSBoNjIuODU3MzUzNzk0NjI4ODY0IFY0NTEuMDUwNTcyNDE1MTIwNjYgek00MDcuNjIwNDE1NTE2Njg0MjYsMzc2LjY4MDM0OTU1NDM4MzQ0IGgtMzYuMTkwNTk3NjM5MzMxNzcgdjMyLjgzODc5OTcwNDc0MTEyIEg4NS43MTQ1NzMzNTYzMTIwMyB2LTMyLjgzODc5OTcwNDc0MTEyIEg0OS41MjM5NzU3MTY5ODAzMiBWODYuOTI2MjM0NTEyNTUwMDIgaDM2LjE5MDU5NzYzOTMzMTc3IFY1MC4yMjQwNDY2MDcyNTExMjUgaDI4Ny42MjAwMTI4MTc4NDcyIHYzNi43MDIxODc5MDUyOTg5IGgzNC4yODU4MjkzNDI1MjQ4MzUgVjM3Ni42ODAzNDk1NTQzODM0NCB6IiBpZD0ic3ZnXzIiIGNsYXNzPSIiIGZpbGw9IiMxYTFhZWIiIGZpbGwtb3BhY2l0eT0iMSIvPjwvZz48L3N2Zz4=',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    var overlay = this._handled;\n    var map = overlay._map;\n    var edgeMinWidth = overlay.edgeMinWidth;\n    var formerLatLng = overlay.getCorner(this._corner);\n    var newLatLng = this.getLatLng();\n    var scale = this._calculateScalingFactor(formerLatLng, newLatLng);\n\n    /*\n     * checks whether the \"edgeMinWidth\" property is set and tracks the minimum edge length;\n     * this enables preventing scaling to zero, but we might also add an overall scale limit\n     */\n\n    if (!edgeMinWidth) { edgeMinWidth = 50; } /* just in case */\n    var corner1 = map.latLngToLayerPoint(overlay.getCorner(0));\n    var corner2 = map.latLngToLayerPoint(overlay.getCorner(1));\n    var w = Math.abs(corner1.x - corner2.x);\n    var h = Math.abs(corner1.y - corner2.y);\n    var distance = Math.sqrt(w * w + h * h);\n\n    if (distance > edgeMinWidth || scale > 1) {\n      overlay.scaleBy(scale);\n      /*\n       * running scale logic even for a scale ratio of 1\n       * prevents a small, occasional marker flicker\n       */\n    } else {\n      overlay.scaleBy(1);\n    }\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.scaleHandle = function(overlay, idx, options) {\n  return new L.ScaleHandle(overlay, idx, options);\n};\n","/* this is the baseclass other IconSets inherit from,\n* we don't use it directly */\nL.IconSet = L.Class.extend({\n\n  _svg: '<svg xmlns=\"http://www.w3.org/2000/svg\">',\n\n  _symbols: '',\n\n  render: function() {\n    this.addSymbols(this._symbols);\n    return this._svg;\n  },\n\n  addSymbols: function(symbols) {\n    this._svg += symbols;\n  },\n});\n","L.KeymapperIconSet = L.IconSet.extend({\n\n  _symbols:\n      // eslint-disable-next-line max-len\n      '<symbol viewBox=\"0 0 25 25\" id=\"keyboard_open\"><path d=\"M12 23l4-4H8l4 4zm7-15h-2V6h2v2zm0 3h-2V9h2v2zm-3-3h-2V6h2v2zm0 3h-2V9h2v2zm0 4H8v-2h8v2zM7 8H5V6h2v2zm0 3H5V9h2v2zm1-2h2v2H8V9zm0-3h2v2H8V6zm3 3h2v2h-2V9zm0-3h2v2h-2V6zm9-3H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z\"/></symbol>',\n\n});\n","/* eslint-disable max-len */\nL.ToolbarIconSet = L.IconSet.extend({\n  _symbols:\n    '<symbol viewBox=\"0 0 18 18\" id=\"border_clear\"><path d=\"M5.25 3.75h1.5v-1.5h-1.5v1.5zm0 6h1.5v-1.5h-1.5v1.5zm0 6h1.5v-1.5h-1.5v1.5zm3-3h1.5v-1.5h-1.5v1.5zm0 3h1.5v-1.5h-1.5v1.5zm-6 0h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm6 6h1.5v-1.5h-1.5v1.5zm6 3h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm0 6h1.5v-1.5h-1.5v1.5zm0-9h1.5v-1.5h-1.5v1.5zm-6 0h1.5v-1.5h-1.5v1.5zm6-4.5v1.5h1.5v-1.5h-1.5zm-6 1.5h1.5v-1.5h-1.5v1.5zm3 12h1.5v-1.5h-1.5v1.5zm0-6h1.5v-1.5h-1.5v1.5zm0-6h1.5v-1.5h-1.5v1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"border_outer\"><path d=\"M9.75 5.25h-1.5v1.5h1.5v-1.5zm0 3h-1.5v1.5h1.5v-1.5zm3 0h-1.5v1.5h1.5v-1.5zm-10.5-6v13.5h13.5V2.25H2.25zm12 12H3.75V3.75h10.5v10.5zm-4.5-3h-1.5v1.5h1.5v-1.5zm-3-3h-1.5v1.5h1.5v-1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"cancel\"><path d=\"M13.279 5.779l-1.058-1.058L9 7.942 5.779 4.721 4.721 5.779 7.942 9l-3.221 3.221 1.058 1.058L9 10.057l3.221 3.222 1.058-1.058L10.057 9z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"crop_rotate\"><path d=\"M5.603 16.117C3.15 14.947 1.394 12.57 1.125 9.75H0C.383 14.37 4.245 18 8.963 18c.172 0 .33-.015.495-.023L6.6 15.113l-.997 1.005zM9.037 0c-.172 0-.33.015-.495.03L11.4 2.888l.998-.998a7.876 7.876 0 0 1 4.477 6.36H18C17.617 3.63 13.755 0 9.037 0zM12 10.5h1.5V6A1.5 1.5 0 0 0 12 4.5H7.5V6H12v4.5zM6 12V3H4.5v1.5H3V6h1.5v6A1.5 1.5 0 0 0 6 13.5h6V15h1.5v-1.5H15V12H6z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"delete_forever\"><path d=\"M4.5 14.25c0 .825.675 1.5 1.5 1.5h6c.825 0 1.5-.675 1.5-1.5v-9h-9v9zm1.845-5.34l1.058-1.058L9 9.443l1.59-1.59 1.058 1.058-1.59 1.59 1.59 1.59-1.058 1.058L9 11.558l-1.59 1.59-1.058-1.058 1.59-1.59-1.597-1.59zM11.625 3l-.75-.75h-3.75l-.75.75H3.75v1.5h10.5V3h-2.625z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"distort\"><path d=\"M1.7 1.4H6v1.4h5.8V1.4h4.3v4.3h-1.4v5.8h1.4v4.4h-4.3v-1.5H6v1.5H1.7v-4.4h1.4V5.7H1.7V1.4zm10.1 4.3V4.3H6v1.4H4.6v5.8H6V13h5.8v-1.5h1.4V5.7h-1.4zM3.1 2.8v1.5h1.5V2.8H3.1zm10.1 0v1.5h1.5V2.8h-1.5zM3.1 13v1.4h1.5V13H3.1zm10.1 0v1.4h1.5V13h-1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"explore\"><path d=\"M9 1.5C4.86 1.5 1.5 4.86 1.5 9c0 4.14 3.36 7.5 7.5 7.5 4.14 0 7.5-3.36 7.5-7.5 0-4.14-3.36-7.5-7.5-7.5zM9 15c-3.308 0-6-2.693-6-6 0-3.308 2.692-6 6-6 3.307 0 6 2.692 6 6 0 3.307-2.693 6-6 6zm-4.125-1.875l5.633-2.617 2.617-5.633-5.633 2.617-2.617 5.633zM9 8.175c.457 0 .825.367.825.825A.823.823 0 0 1 9 9.825.823.823 0 0 1 8.175 9c0-.457.367-.825.825-.825z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"flip_to_back\"><path d=\"M6.75 5.25h-1.5v1.5h1.5v-1.5zm0 3h-1.5v1.5h1.5v-1.5zm0-6a1.5 1.5 0 0 0-1.5 1.5h1.5v-1.5zm3 9h-1.5v1.5h1.5v-1.5zm4.5-9v1.5h1.5c0-.825-.675-1.5-1.5-1.5zm-4.5 0h-1.5v1.5h1.5v-1.5zm-3 10.5v-1.5h-1.5a1.5 1.5 0 0 0 1.5 1.5zm7.5-3h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm0 6c.825 0 1.5-.675 1.5-1.5h-1.5v1.5zm-10.5-7.5h-1.5v9a1.5 1.5 0 0 0 1.5 1.5h9v-1.5h-9v-9zm7.5-1.5h1.5v-1.5h-1.5v1.5zm0 9h1.5v-1.5h-1.5v1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"flip_to_front\"><path d=\"M2.25 9.75h1.5v-1.5h-1.5v1.5zm0 3h1.5v-1.5h-1.5v1.5zm1.5 3v-1.5h-1.5a1.5 1.5 0 0 0 1.5 1.5zm-1.5-9h1.5v-1.5h-1.5v1.5zm9 9h1.5v-1.5h-1.5v1.5zm3-13.5h-7.5a1.5 1.5 0 0 0-1.5 1.5v7.5a1.5 1.5 0 0 0 1.5 1.5h7.5c.825 0 1.5-.675 1.5-1.5v-7.5c0-.825-.675-1.5-1.5-1.5zm0 9h-7.5v-7.5h7.5v7.5zm-6 4.5h1.5v-1.5h-1.5v1.5zm-3 0h1.5v-1.5h-1.5v1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"get_app\"><path d=\"M14.662 6.95h-3.15v-4.5H6.787v4.5h-3.15L9.15 12.2l5.512-5.25zM3.637 13.7v1.5h11.025v-1.5H3.637z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"lock\"><path d=\"M13.5 6h-.75V4.5C12.75 2.43 11.07.75 9 .75 6.93.75 5.25 2.43 5.25 4.5V6H4.5C3.675 6 3 6.675 3 7.5V15c0 .825.675 1.5 1.5 1.5h9c.825 0 1.5-.675 1.5-1.5V7.5c0-.825-.675-1.5-1.5-1.5zM6.75 4.5A2.247 2.247 0 0 1 9 2.25a2.247 2.247 0 0 1 2.25 2.25V6h-4.5V4.5zM13.5 15h-9V7.5h9V15zM9 12.75c.825 0 1.5-.675 1.5-1.5s-.675-1.5-1.5-1.5-1.5.675-1.5 1.5.675 1.5 1.5 1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"opacity\"><path d=\"M13.245 6L9 1.763 4.755 6A6.015 6.015 0 0 0 3 10.23c0 1.5.585 3.082 1.755 4.252a5.993 5.993 0 0 0 8.49 0A6.066 6.066 0 0 0 15 10.23c0-1.5-.585-3.06-1.755-4.23zM4.5 10.5c.008-1.5.465-2.453 1.32-3.3L9 3.952l3.18 3.285c.855.84 1.313 1.763 1.32 3.263h-9z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 14 18\" id=\"opacity_empty\"><path stroke=\"#0078A8\" stroke-width=\"1.7\" d=\"M10.708 6.25A5.113 5.113 0 0 1 12.2 9.846c0 1.275-.497 2.62-1.492 3.614a5.094 5.094 0 0 1-7.216 0A5.156 5.156 0 0 1 2 9.846c0-1.275.497-2.601 1.492-3.596L7.1 2.648l3.608 3.602zm0 0L7.1 2.648 3.492 6.25A5.113 5.113 0 0 0 2 9.846c0 1.275.497 2.62 1.492 3.614a5.094 5.094 0 0 0 7.216 0A5.156 5.156 0 0 0 12.2 9.846a5.113 5.113 0 0 0-1.492-3.596z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"restore\"><path d=\"M15.67 3.839a.295.295 0 0 0-.22.103l-5.116 3.249V4.179a.342.342 0 0 0-.193-.315.29.29 0 0 0-.338.078L3.806 7.751v-4.63h-.002l.002-.022c0-.277-.204-.502-.456-.502h-.873V2.6c-.253 0-.457.225-.457.503l.002.026v10.883h.005c.021.257.217.454.452.455l.016-.002h.822c.013.001.025.004.038.004.252 0 .457-.225.457-.502a.505.505 0 0 0-.006-.068V9.318l6.001 3.811a.288.288 0 0 0 .332.074.34.34 0 0 0 .194-.306V9.878l5.12 3.252a.288.288 0 0 0 .332.073.34.34 0 0 0 .194-.306V4.18a.358.358 0 0 0-.09-.24.296.296 0 0 0-.218-.1z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"rotate\"><path d=\"M5.505 4.808L.645 9.675l4.867 4.86 4.868-4.86-4.875-4.868zM2.768 9.675L5.513 6.93 8.25 9.675 5.505 12.42 2.768 9.675zM14.52 4.98A6.713 6.713 0 009.75 3V.57L6.57 3.75l3.18 3.18V4.5a5.23 5.23 0 013.713 1.537 5.255 5.255 0 010 7.426 5.23 5.23 0 01-5.843 1.08L6.503 15.66a6.76 6.76 0 003.247.84c1.725 0 3.457-.66 4.77-1.98a6.735 6.735 0 000-9.54z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"scale\"><path d=\"M8.25 9h-6a.75.75 0 00-.75.75v6c0 .414.336.75.75.75h6a.75.75 0 00.75-.75v-6A.75.75 0 008.25 9zm-.75 6H3v-4.5h4.5V15zm8.94-13.035a.75.75 0 00-.405-.405.75.75 0 00-.285-.06h-4.5a.75.75 0 000 1.5h2.692L9.967 6.968a.75.75 0 000 1.064.75.75 0 001.065 0L15 4.057V6.75a.75.75 0 101.5 0v-4.5a.75.75 0 00-.06-.285z\" /></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"spinner\"><path d=\"M9 6.48c-.216 0-.36-.144-.36-.36V3.24c0-.216.144-.36.36-.36s.36.144.36.36v2.88c0 .216-.144.36-.36.36z\"/><path d=\"M9 15.12c-.216 0-.36-.144-.36-.36v-2.88c0-.216.144-.36.36-.36s.36.144.36.36v2.88c0 .216-.144.36-.36.36zm1.44-8.28c-.072 0-.108 0-.18-.036-.144-.108-.216-.288-.108-.468l1.44-2.484c.108-.144.288-.216.468-.108.144.108.216.288.108.468l-1.44 2.484c-.072.072-.18.144-.288.144zm-4.32 7.488c-.072 0-.108 0-.18-.036-.144-.108-.216-.288-.108-.468l1.44-2.484c.108-.144.288-.216.468-.108.144.108.216.288.108.468l-1.44 2.484c-.072.072-.18.144-.288.144z\" opacity=\".3\"/><path d=\"M7.56 6.84c-.108 0-.216-.072-.288-.18l-1.44-2.484c-.108-.144-.036-.36.108-.468.144-.108.36-.036.468.108L7.848 6.3c.108.144.036.36-.108.468-.072.072-.108.072-.18.072z\" opacity=\".93\"/><path d=\"M11.88 14.328c-.108 0-.216-.072-.288-.18l-1.44-2.484c-.108-.144-.036-.36.108-.468.144-.108.36-.036.468.108l1.44 2.484c.108.144.036.36-.108.468-.072.036-.108.072-.18.072z\" opacity=\".3\"/><path d=\"M6.12 9.36H3.24c-.216 0-.36-.144-.36-.36s.144-.36.36-.36h2.88c.216 0 .36.144.36.36s-.144.36-.36.36z\" opacity=\".65\"/><path d=\"M14.76 9.36h-2.88c-.216 0-.36-.144-.36-.36s.144-.36.36-.36h2.88c.216 0 .36.144.36.36s-.144.36-.36.36z\" opacity=\".3\"/><path d=\"M6.516 7.884c-.072 0-.108 0-.18-.036l-2.484-1.44c-.144-.108-.216-.288-.108-.468.108-.144.288-.216.468-.108l2.484 1.44c.144.108.216.288.108.468a.327.327 0 01-.288.144z\" opacity=\".86\"/><path d=\"M14.004 12.204c-.072 0-.108 0-.18-.036l-2.484-1.44c-.144-.108-.216-.288-.108-.468.108-.144.288-.216.468-.108l2.484 1.44c.144.108.216.288.108.468a.327.327 0 01-.288.144z\" opacity=\".3\"/><path d=\"M3.996 12.204c-.108 0-.216-.072-.288-.18-.108-.144-.036-.36.108-.468l2.484-1.44c.144-.108.36-.036.468.108.108.144.036.36-.108.468l-2.484 1.44c-.036.072-.108.072-.18.072z\" opacity=\".44\"/><path d=\"M11.484 7.884c-.108 0-.216-.072-.288-.18-.108-.144-.036-.36.108-.468l2.484-1.44c.144-.108.36-.036.468.108.108.144.036.36-.108.468l-2.484 1.44c-.072.072-.108.072-.18.072z\" opacity=\".3\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"drag\"><path d=\"M2.3 16.5c-0.2 0-0.4-0.1-0.5-0.2 -0.2-0.2-0.3-0.5-0.2-0.8l2.5-6.5 -2.5-6.5C1.5 2.3 1.5 2 1.7 1.8c0.2-0.2 0.5-0.3 0.8-0.2l6.5 2.5 6.5-2.5c0.3-0.1 0.6 0 0.8 0.2 0.2 0.2 0.3 0.5 0.2 0.8l-2.5 6.5 2.5 6.5c0.1 0.3 0 0.6-0.2 0.8 -0.2 0.2-0.5 0.3-0.8 0.2l-6.5-2.5 -6.5 2.5C2.4 16.5 2.3 16.5 2.3 16.5zM3.6 3.6l2 5.1c0.1 0.2 0.1 0.4 0 0.5l-2 5.1 5.1-2c0.2-0.1 0.4-0.1 0.5 0l5.1 2L12.4 9.3c-0.1-0.2-0.1-0.4 0-0.5l2-5.1L9.3 5.6c-0.2 0.1-0.4 0.1-0.5 0L3.6 3.6z\" /></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"unlock\"><path d=\"M13.5 6h-.75V4.5C12.75 2.43 11.07.75 9 .75 6.93.75 5.25 2.43 5.25 4.5h1.5A2.247 2.247 0 0 1 9 2.25a2.247 2.247 0 0 1 2.25 2.25V6H4.5C3.675 6 3 6.675 3 7.5V15c0 .825.675 1.5 1.5 1.5h9c.825 0 1.5-.675 1.5-1.5V7.5c0-.825-.675-1.5-1.5-1.5zm0 9h-9V7.5h9V15zM9 12.75c.825 0 1.5-.675 1.5-1.5s-.675-1.5-1.5-1.5-1.5.675-1.5 1.5.675 1.5 1.5 1.5z\"/></symbol>',\n});\n","L.DistortableImage = L.DistortableImage || {};\nL.distortableImage = L.DistortableImage;\n\nL.DistortableImage.action_map = {};\n\nL.EditAction = L.Toolbar2.Action.extend({\n  options: {\n    toolbarIcon: {\n      svg: false,\n      html: '',\n      className: '',\n      tooltip: '',\n    },\n  },\n\n  initialize: function(map, overlay, options) {\n    this._overlay = overlay;\n    this._map = map;\n\n    L.setOptions(this, options);\n    L.Toolbar2.Action.prototype.initialize.call(this, options);\n\n    this._injectIconSet();\n  },\n\n  _createIcon: function(toolbar, container, args) {\n    var iconOptions = this.options.toolbarIcon;\n    var className = iconOptions.className;\n    var edit = this._overlay.editing;\n\n    this.toolbar = toolbar;\n    this._icon = L.DomUtil.create('li', '', container);\n    this._link = L.DomUtil.create('a', '', this._icon);\n\n    if (iconOptions.svg) {\n      this._link.innerHTML = L.IconUtil.create(iconOptions.html);\n    } else {\n      this._link.innerHTML = iconOptions.html;\n    }\n\n    this._link.setAttribute('href', '#');\n    this._link.setAttribute('title', iconOptions.tooltip);\n    this._link.setAttribute('role', 'button');\n\n    L.DomUtil.addClass(this._link, this.constructor.baseClass);\n\n    if (className) {\n      L.DomUtil.addClass(this._link, className);\n      if (className === 'disabled') {\n        L.DomUtil.addClass(this._icon, className);\n      }\n      if (className === edit._mode) {\n        L.DomUtil.addClass(this._link, 'selected-mode');\n      } else {\n        L.DomUtil.removeClass(this._link, 'selected-mode');\n      }\n    }\n\n    L.DomEvent.on(this._link, 'click', this.enable, this);\n    L.DomEvent.on(this._overlay, 'update', () => {\n      var match = this._link.innerHTML.match(/xlink:href=\"#restore\"/);\n      if (match && match.length === 1) { this._enableAction(); }\n    });\n\n    /* Add secondary toolbar */\n    this._addSubToolbar(toolbar, this._icon, args);\n  },\n\n  _injectIconSet: function() {\n    if (document.querySelector('#iconset')) {\n      return;\n    }\n\n    var el = document.createElement('div');\n    el.id = 'iconset';\n    el.setAttribute('hidden', 'hidden');\n    el.innerHTML = new L.ToolbarIconSet().render();\n\n    document.querySelector('.leaflet-marker-pane').appendChild(el);\n  },\n\n  _enableAction: function() {\n    L.DomUtil.removeClass(this._link.parentElement, 'disabled');\n    L.DomUtil.removeClass(this._link, 'disabled');\n  },\n\n  _disableAction: function() {\n    L.DomUtil.addClass(this._link.parentElement, 'disabled');\n    L.DomUtil.addClass(this._link, 'disabled');\n  },\n});\n\nL.editAction = function(map, overlay, options) {\n  return new L.EditAction(map, overlay, options);\n};\n","L.BorderAction = L.EditAction.extend({\n  initialize: function(map, overlay, options) {\n    var edit = overlay.editing;\n    var mode = edit._mode;\n    var use;\n    var tooltip;\n\n    if (edit._outlined) {\n      use = 'border_outer';\n      tooltip = overlay.options.translation.removeBorder;\n    } else {\n      use = 'border_clear';\n      tooltip = overlay.options.translation.addBorder;\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: use,\n      tooltip: tooltip,\n      className: mode === 'lock' ? 'disabled' : '',\n    };\n\n    // conditional for disabling keybindings for this action when the image is locked.\n    L.DistortableImage.action_map.b = mode === 'lock' ? '' : '_toggleBorder';\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks: function() {\n    var edit = this._overlay.editing;\n\n    L.IconUtil.toggleXlink(this._link, 'border_clear', 'border_outer');\n    L.IconUtil.toggleTitle(this._link, 'Remove Border', 'Add Border');\n    edit._toggleBorder();\n  },\n});\n","L.DeleteAction = L.EditAction.extend({\n  initialize: function(map, overlay, options) {\n    var edit = overlay.editing;\n    var use = 'delete_forever';\n    var tooltip;\n    /**\n      * we can tell whether the overlay is an instance of `L.DistortableImageOverlay` or `L.DistortableCollection` bc only\n      * the former should have `parentGroup` defined on it. From there we call the apporpriate keybindings and methods.\n      */\n    if (edit instanceof L.DistortableImage.Edit) {\n      tooltip = overlay.options.translation.deleteImage;\n      // backspace windows / delete mac\n      L.DistortableImage.action_map.Backspace = (\n        edit._mode === 'lock' ? '' : '_removeOverlay'\n      );\n    } else {\n      tooltip = overlay.options.translation.deleteImages;\n      L.DistortableImage.group_action_map.Backspace = (\n        edit._mode === 'lock' ? '' : '_removeGroup'\n      );\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: use,\n      tooltip: tooltip,\n      className: edit._mode === 'lock' ? 'disabled' : '',\n    };\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks: function() {\n    var edit = this._overlay.editing;\n\n    if (edit instanceof L.DistortableImage.Edit) { edit._removeOverlay(); }\n    else { edit._removeGroup(); }\n  },\n});\n","L.DistortAction = L.EditAction.extend({\n  initialize: function(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'distort',\n      tooltip: overlay.options.translation.distortImage,\n      className: 'distort',\n    };\n\n    L.DistortableImage.action_map.d = '_distortMode';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks: function() {\n    var edit = this._overlay.editing;\n    edit._distortMode();\n  },\n});\n","L.DragAction = L.EditAction.extend({\n  initialize: function(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'drag',\n      tooltip: overlay.options.translation.dragImage,\n      className: 'drag',\n    };\n\n    L.DistortableImage.action_map.D = '_dragMode';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks: function() {\n    var edit = this._overlay.editing;\n    edit._dragMode();\n  },\n});\n","L.ExportAction = L.EditAction.extend({\n  // This function is executed every time we select an image\n  initialize: function(map, overlay, options) {\n    var edit = overlay.editing;\n    var tooltip;\n\n    this.isExporting = false;\n    this.mouseLeaveSkip = true;\n    this.isHooksExecuted = false;\n\n    if (edit instanceof L.DistortableImage.Edit) {\n      L.DistortableImage.action_map.e = '_getExport';\n      tooltip = overlay.options.translation.exportImage;\n    } else {\n      L.DistortableImage.group_action_map.e = 'runExporter';\n      tooltip = overlay.options.translation.exportImages;\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'get_app',\n      tooltip: tooltip,\n    };\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks: function() {\n    var edit = this._overlay.editing;\n\n    if (edit instanceof L.DistortableImage.Edit) {\n      edit._getExport();\n      return;\n    }\n\n    // Make sure that addHooks is executed only once, event listeners will handle the rest\n    if (this.isHooksExecuted) {\n      return;\n    } else {\n      this.isHooksExecuted = true;\n    }\n\n    var exportTool = this._link.parentElement;\n\n    this.mouseEnterHandler = this.handleMouseEnter.bind(this);\n    this.mouseLeaveHandler = this.handleMouseLeave.bind(this);\n\n    L.DomEvent.on(exportTool, 'click', function() {\n      if (!this.isExporting) {\n        this.isExporting = true;\n        this.renderExportIcon();\n\n        setTimeout(this.attachMouseEventListeners.bind(this, exportTool), 100);\n        edit.runExporter().then(\n            function() {\n              this.resetState();\n              this.detachMouseEventListeners(exportTool);\n            }.bind(this)\n        );\n      } else {\n        // Clicking on the export icon after export has started will be ignored\n        if (this.mouseLeaveSkip) {\n          return;\n        }\n\n        this.resetState();\n        this.detachMouseEventListeners(exportTool);\n        edit.cancelExport();\n      }\n    }, this);\n  },\n\n  resetState: function() {\n    this.renderDownloadIcon();\n    this.isExporting = false;\n    this.mouseLeaveSkip = true;\n  },\n\n  attachMouseEventListeners: function(element) {\n    element.addEventListener('mouseenter', this.mouseEnterHandler);\n    element.addEventListener('mouseleave', this.mouseLeaveHandler);\n  },\n\n  detachMouseEventListeners: function(element) {\n    element.removeEventListener('mouseenter', this.mouseEnterHandler);\n    element.removeEventListener('mouseleave', this.mouseLeaveHandler);\n  },\n\n  handleMouseEnter: function() {\n    this.renderCancelIcon();\n  },\n\n  handleMouseLeave: function() {\n    if (!this.mouseLeaveSkip) {\n      this.renderExportIcon();\n    } else {\n      this.mouseLeaveSkip = false;\n    }\n  },\n\n  renderDownloadIcon: function() {\n    L.IconUtil.toggleXlink(this._link, 'get_app', 'spinner');\n    L.IconUtil.toggleTitle(this._link, 'Export Images', 'Loading...');\n    L.DomUtil.removeClass(this._link.firstChild, 'loader');\n  },\n\n  renderExportIcon: function() {\n    L.IconUtil.toggleXlink(this._link, 'spinner');\n    L.IconUtil.toggleTitle(this._link, 'Export Images', 'Loading...');\n    L.IconUtil.addClassToSvg(this._link, 'loader');\n  },\n\n  renderCancelIcon: function() {\n    L.IconUtil.toggleXlink(this._link, 'cancel');\n    L.IconUtil.toggleTitle(this._link, 'Cancel Export', 'Loading...');\n    L.DomUtil.removeClass(this._link.firstChild, 'loader');\n  },\n});\n","L.FreeRotateAction = L.EditAction.extend({\n  initialize: function(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'crop_rotate',\n      tooltip: overlay.options.translation.freeRotateImage,\n      className: 'freeRotate',\n    };\n\n    L.DistortableImage.action_map.f = '_freeRotateMode';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks: function() {\n    var edit = this._overlay.editing;\n    edit._freeRotateMode();\n  },\n});\n","L.GeolocateAction = L.EditAction.extend({\n  initialize: function(map, overlay, options) {\n    var edit = overlay.editing;\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'explore',\n      tooltip: overlay.options.translation.geolocateImage,\n      className: edit._mode === 'lock' ? 'disabled' : '',\n    };\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks: function() {\n    var image = this._overlay.getElement();\n\n    EXIF.getData(image, L.EXIF(image));\n  },\n});\n","L.LockAction = L.EditAction.extend({\n  initialize: function(map, overlay, options) {\n    var edit = overlay.editing;\n    var use;\n    var tooltip;\n\n    if (edit instanceof L.DistortableImage.Edit) {\n      L.DistortableImage.action_map.u = '_unlock';\n      L.DistortableImage.action_map.l = '_lock';\n      tooltip = overlay.options.translation.lockMode;\n\n      use = edit.isMode('lock') ? 'lock' : 'unlock';\n    } else {\n      L.DistortableImage.group_action_map.l = '_lockGroup';\n      tooltip = overlay.options.translation.lockImages;\n      use = 'lock';\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: use,\n      tooltip: tooltip,\n      className: 'lock',\n    };\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks: function() {\n    var edit = this._overlay.editing;\n\n    if (edit instanceof L.DistortableImage.Edit) { edit._toggleLockMode(); }\n    else { edit._lockGroup(); }\n  },\n});\n","L.OpacityAction = L.EditAction.extend({\n  initialize: function(map, overlay, options) {\n    var edit = overlay.editing;\n    var mode = edit._mode;\n    var use;\n    var tooltip;\n\n    if (edit._transparent) {\n      use = 'opacity_empty';\n      tooltip = overlay.options.translation.makeImageOpaque;\n    } else {\n      use = 'opacity';\n      tooltip = overlay.options.translation.makeImageTransparent;\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: use,\n      tooltip: tooltip,\n      className: mode === 'lock' ? 'disabled' : '',\n    };\n\n    L.DistortableImage.action_map.o = mode === 'lock' ? '' : '_toggleOpacity';\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks: function() {\n    var edit = this._overlay.editing;\n    var link = this._link;\n\n    L.IconUtil.toggleXlink(link, 'opacity', 'opacity_empty');\n    L.IconUtil.toggleTitle(link, 'Make Image Transparent', 'Make Image Opaque');\n    edit._toggleOpacity();\n  },\n});\n","L.RestoreAction = L.EditAction.extend({\n  initialize: function(map, overlay, options) {\n    var mode = L.Utils.getNestedVal(overlay, 'editing', '_mode');\n    var edited = overlay.edited;\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'restore',\n      tooltip: overlay.options.translation.restoreImage,\n      className: edited && mode !== 'lock' ? '' : 'disabled',\n    };\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks: function() {\n    var ov = this._overlay;\n\n    L.DomEvent.on(ov, {\n      edit: this._enableAction,\n      restore: this._disableAction,\n    }, this);\n\n    ov.restore();\n  },\n});\n","L.RotateAction = L.EditAction.extend({\n  initialize: function(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'rotate',\n      tooltip: overlay.options.translation.rotateImage,\n      className: 'rotate',\n    };\n\n    L.DistortableImage.action_map.r = '_rotateMode';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks: function() {\n    var edit = this._overlay.editing;\n    edit._rotateMode();\n  },\n});\n","L.ScaleAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'scale',\n      tooltip: overlay.options.translation.scaleImage,\n      className: 'scale',\n    };\n\n    L.DistortableImage.action_map.s = '_scaleMode';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    var edit = this._overlay.editing;\n    edit._scaleMode();\n  },\n});\n","L.StackAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    var edit = overlay.editing;\n    var use;\n    var tooltip;\n\n    if (edit._toggledImage) {\n      use = 'flip_to_back';\n      tooltip = overlay.options.translation.stackToFront;\n    } else {\n      use = 'flip_to_front';\n      tooltip = overlay.options.translation.stackToBack;\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: use,\n      tooltip: tooltip,\n      className: edit._mode === 'lock' ? 'disabled' : '',\n    };\n\n    L.DistortableImage.action_map.q = edit._mode === 'lock' ? '' : '_stackUp';\n    L.DistortableImage.action_map.a = edit._mode === 'lock' ? '' : '_stackDown';\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    var edit = this._overlay.editing;\n\n    L.IconUtil.toggleXlink(this._link, 'flip_to_front', 'flip_to_back');\n    L.IconUtil.toggleTitle(this._link, 'Stack to Front', 'Stack to Back');\n    edit._toggleOrder();\n  },\n});\n","L.UnlockAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'unlock',\n      tooltip: overlay.options.translation.unlockImages,\n    };\n\n    L.DistortableImage.group_action_map.u = '_unlockGroup';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    var edit = this._overlay.editing;\n    edit._unlockGroup();\n  },\n});\n","L.DistortableImage = L.DistortableImage || {};\nL.distortableImage = L.DistortableImage;\n\nL.DistortableImage.action_map = {};\n\nL.DistortableImage.PopupBar = L.Toolbar2.Popup.extend({\n  options: {\n    anchor: [0, -10],\n  },\n\n  initialize: function(latlng, options) {\n    L.setOptions(this, options);\n    L.Toolbar2.Popup.prototype.initialize.call(this, latlng, options);\n  },\n\n  addHooks: function(map, ov) {\n    this.map = map;\n    this.ov = ov;\n  },\n\n  tools: function() {\n    if (this._ul) {\n      return this._ul.children;\n    }\n  },\n\n  clickTool: function(name) {\n    var tools = this.tools();\n    for (var i = 0; i < tools.length; i++) {\n      var tool = tools.item(i).children[0];\n      if (L.DomUtil.hasClass(tool, name)) {\n        tool.click();\n        return tool;\n      }\n    }\n    return false;\n  },\n});\n\nL.distortableImage.popupBar = function(latlng, options) {\n  return new L.DistortableImage.PopupBar(latlng, options);\n};\n\nL.DistortableImageOverlay.addInitHook(function() {\n  /** Default actions */\n  this.ACTIONS = [\n    L.DragAction,\n    L.ScaleAction,\n    L.DistortAction,\n    L.RotateAction,\n    L.FreeRotateAction,\n    L.LockAction,\n    L.OpacityAction,\n    L.BorderAction,\n    L.ExportAction,\n    L.DeleteAction,\n  ];\n\n  // all possible modes\n  L.DistortableImage.Edit.MODES = {\n    drag: L.DragAction,\n    scale: L.ScaleAction,\n    distort: L.DistortAction,\n    rotate: L.RotateAction,\n    freeRotate: L.FreeRotateAction,\n    lock: L.LockAction,\n  };\n\n  var a = this.options.actions ? this.options.actions : this.ACTIONS;\n\n  this.editing = L.distortableImage.edit(this, {actions: a});\n});\n","L.distortableImage = L.DistortableImage || {};\nL.distortableImage = L.DistortableImage;\n\nL.DistortableImage.group_action_map = {};\n\nL.DistortableImage.ControlBar = L.Toolbar2.Control.extend({});\n\nL.distortableImage.controlBar = function(options) {\n  return new L.DistortableImage.ControlBar(options);\n};\n\n/** addInitHooks run before onAdd */\nL.DistortableCollection.addInitHook(function() {\n  /** Default actions */\n  this.ACTIONS = [\n    L.ExportAction,\n    L.DeleteAction,\n    L.LockAction,\n    L.UnlockAction,\n  ];\n\n  // all possible modes\n  L.DistortableCollection.Edit.MODES = {\n    lock: L.LockAction,\n    unlock: L.UnlockAction,\n  };\n\n  var a = this.options.actions ? this.options.actions : this.ACTIONS;\n\n  this.editing = L.distortableCollection.edit(this, {actions: a});\n});\n","L.DistortableImage = L.DistortableImage || {};\n\n// holds the keybindings & toolbar API for an individual image instance\nL.DistortableImage.Edit = L.Handler.extend({\n  options: {\n    opacity: 0.7,\n    outline: '1px solid red',\n    keymap: L.distortableImage.action_map,\n  },\n\n  initialize: function(overlay, options) {\n    this._overlay = overlay;\n    this._toggledImage = false;\n    this._mode = overlay.options.mode;\n    this._transparent = false;\n    this._outlined = false;\n\n    L.setOptions(this, options);\n\n    L.distortableImage.action_map.Escape = '_deselect';\n  },\n\n  /* Run on image selection. */\n  addHooks: function() {\n    var overlay = this._overlay;\n\n    this.editActions = this.options.actions;\n\n    /* bring the selected image into view */\n    overlay.bringToFront();\n    this._initModes();\n    this._initHandles();\n    this._appendHandlesandDragable();\n\n\n    if (overlay.isSelected() && !overlay.options.suppressToolbar) {\n      this._addToolbar();\n    }\n\n    this.parentGroup = overlay.eP ? overlay.eP : false;\n\n    L.DomEvent.on(overlay.getElement(), {\n      dblclick: this.nextMode,\n    }, this);\n\n    L.DomEvent.on(window, 'keydown', this._onKeyDown, this);\n  },\n\n  /* Run on image deselection. */\n  removeHooks: function() {\n    var overlay = this._overlay;\n    var eP = this.parentGroup;\n\n    // First, check if dragging exists - it may be off due to locking\n    this._disableDragging();\n\n    if (this.toolbar) { this._removeToolbar(); }\n\n    for (var handle in this._handles) {\n      L.DomUtil.remove(handle);\n    }\n\n    /**\n     * ensures if you disable an image while it is multi-selected\n     * additional deselection logic is run\n     */\n    if (L.DomUtil.hasClass(overlay.getElement(), 'collected')) {\n      L.DomUtil.removeClass(overlay.getElement(), 'collected');\n    }\n\n    if (eP && (!eP.anyCollected() && eP.editing.toolbar)) {\n      eP.editing._removeToolbar();\n    }\n\n    L.DomEvent.off(overlay.getElement(), {\n      dblclick: this.nextMode,\n    }, this);\n\n    L.DomEvent.off(window, 'keydown', this._onKeyDown, this);\n  },\n\n  disable: function() {\n    if (!this._enabled) { return this; }\n\n    this._overlay.deselect();\n    this._enabled = false;\n    this.removeHooks();\n    return this;\n  },\n\n  _initModes: function() {\n    this._modes = {};\n    // passed from L.DistortablImage.PopupBar. If the mode is one\n    // of the current toolbar actions, adds it to this._modes\n    for (var mode in L.DistortableImage.Edit.MODES) {\n      var action = L.DistortableImage.Edit.MODES[mode];\n      if (this.editActions.indexOf(action) !== -1) {\n        this._modes[mode] = action;\n      }\n    }\n\n    // sets the current mode to the 1st available one if the one selected\n    // during initialization is not available\n    if (!this._modes[this._mode]) {\n      this._mode = Object.keys(this._modes)[0];\n    }\n  },\n\n\n  _initHandles: function() {\n    var overlay = this._overlay;\n    var i;\n\n    this._dragHandles = L.layerGroup();\n    for (i = 0; i < 4; i++) {\n      this._dragHandles.addLayer(L.dragHandle(overlay, i));\n    }\n\n    this._scaleHandles = L.layerGroup();\n    for (i = 0; i < 4; i++) {\n      this._scaleHandles.addLayer(L.scaleHandle(overlay, i));\n    }\n\n    this._distortHandles = L.layerGroup();\n    for (i = 0; i < 4; i++) {\n      this._distortHandles.addLayer(L.distortHandle(overlay, i));\n    }\n\n    this._rotateHandles = L.layerGroup(); // individual rotate\n    for (i = 0; i < 4; i++) {\n      this._rotateHandles.addLayer(L.rotateHandle(overlay, i));\n    }\n\n    // handle includes rotate AND scale\n    this._freeRotateHandles = L.layerGroup();\n    for (i = 0; i < 4; i++) {\n      this._freeRotateHandles.addLayer(L.freeRotateHandle(overlay, i));\n    }\n\n    this._lockHandles = L.layerGroup();\n    for (i = 0; i < 4; i++) {\n      this._lockHandles.addLayer(L.lockHandle(overlay, i, {draggable: false}));\n    }\n\n    this._handles = {\n      drag: this._dragHandles,\n      scale: this._scaleHandles,\n      distort: this._distortHandles,\n      rotate: this._rotateHandles,\n      freeRotate: this._freeRotateHandles,\n      lock: this._lockHandles,\n    };\n  },\n\n  _appendHandlesandDragable: function() {\n    var ov = this._overlay;\n\n    // won't throw error if user adds 0 mode actions to toolbar\n    if (!this._mode) {\n      this._enableDragging();\n      return;\n    }\n\n    this._updateHandle();\n\n    if (!ov.isSelected() && this.currentHandle) {\n      this.currentHandle.eachLayer((handle) => {\n        handle.setOpacity(0);\n        if (handle.dragging) { handle.dragging.disable(); }\n      });\n    }\n    if (!this.isMode('lock')) { this._enableDragging(); }\n  },\n\n  _onKeyDown: function(e) {\n    var keymap = this.options.keymap;\n    var handlerName = keymap[e.key];\n    var ov = this._overlay;\n    var eP = this.parentGroup;\n\n    if (eP && eP.anyCollected()) { return; }\n\n    if (this[handlerName] !== undefined && !ov.options.suppressToolbar) {\n      if (ov.isSelected() && this.toolbar) {\n        this[handlerName].call(this);\n      }\n    }\n  },\n\n  replaceTool: function(old, next) {\n    if (next.baseClass !== 'leaflet-toolbar-icon' || this.hasTool(next)) {\n      return this;\n    }\n    this.editActions.some((item, idx) => {\n      if (item === old) {\n        this._removeToolbar();\n        this.editActions[idx] = next;\n        this._addToolbar();\n        for (var mode in L.DistortableImage.Edit.MODES) {\n          if (L.DistortableImage.Edit.MODES[mode] === old) {\n            delete this._modes[mode];\n            this._nextOrNone(mode);\n          } else if (L.DistortableImage.Edit.MODES[mode] === next) {\n            this._modes[mode] = next;\n          }\n        }\n        return true;\n      }\n    });\n    return this;\n  },\n\n  addTool: function(value) {\n    if (value.baseClass === 'leaflet-toolbar-icon' && !this.hasTool(value)) {\n      this._removeToolbar();\n      this.editActions.push(value);\n      this._addToolbar();\n      for (var mode in L.DistortableImage.Edit.MODES) {\n        if (L.DistortableImage.Edit.MODES[mode] === value) {\n          this._modes[mode] = value;\n        }\n      }\n      if (!this._overlay.isSelected()) { this._removeToolbar(); }\n    }\n    return this;\n  },\n\n  hasTool: function(value) {\n    return this.editActions.some(action => action === value);\n  },\n\n  removeTool: function(value) {\n    this.editActions.some((item, idx) => {\n      if (item === value) {\n        this._removeToolbar();\n        this.editActions.splice(idx, 1);\n        this._addToolbar();\n        for (var mode in L.DistortableImage.Edit.MODES) {\n          if (L.DistortableImage.Edit.MODES[mode] === value) {\n            delete this._modes[mode];\n            this._nextOrNone(mode);\n          }\n        }\n        return true;\n      }\n    });\n    if (!this._overlay.isSelected()) { this._removeToolbar(); }\n    return this;\n  },\n\n  // set the mode to the next mode or if that was the last one set mode to ''\n  _nextOrNone: function(mode) {\n    if (this.isMode(mode)) {\n      if (Object.keys(this.getModes()).length >= 1) {\n        this.nextMode();\n      } else {\n        if (mode === 'lock') { this._enableDragging(); }\n        this._mode = '';\n        this._updateHandle();\n      }\n    }\n  },\n\n  _removeToolbar: function() {\n    var ov = this._overlay;\n    var map = ov._map;\n\n    if (this.toolbar) {\n      map.removeLayer(this.toolbar);\n      this.toolbar = false;\n    }\n  },\n\n  _enableDragging: function() {\n    var overlay = this._overlay;\n    var map = overlay._map;\n\n    this.dragging = new L.Draggable(overlay.getElement());\n    this.dragging.enable();\n\n    /* Hide toolbars and markers while dragging; click will re-show it */\n    this.dragging.on('dragstart', () => {\n      overlay.fire('dragstart');\n      this._removeToolbar();\n    });\n\n    /*\n     * Adjust default behavior of L.Draggable, which overwrites the CSS3\n     * distort transformations that we set when it calls L.DomUtil.setPosition.\n     */\n    this.dragging._updatePosition = function() {\n      var topLeft = overlay.getCorner(0);\n      var delta = this._newPos.subtract(map.latLngToLayerPoint(topLeft));\n      var currentPoint;\n      var corners = {};\n      var i;\n\n      this.fire('predrag');\n\n      for (i = 0; i < 4; i++) {\n        currentPoint = map.latLngToLayerPoint(overlay.getCorner(i));\n        corners[i] = map.layerPointToLatLng(currentPoint.add(delta));\n      }\n\n      overlay.setCorners(corners);\n      overlay.fire('drag');\n\n      this.fire('drag');\n    };\n  },\n\n  _disableDragging: function() {\n    if (this.dragging) {\n      this.dragging.disable();\n      delete this.dragging;\n    }\n  },\n\n  _dragMode: function() {\n    this.setMode('drag');\n  },\n\n  _scaleMode: function() {\n    this.setMode('scale');\n  },\n\n  _distortMode: function() {\n    this.setMode('distort');\n  },\n\n  _rotateMode: function() {\n    this.setMode('rotate');\n  },\n\n  _freeRotateMode: function() {\n    this.setMode('freeRotate');\n  },\n\n  _toggleLockMode: function() {\n    if (this.isMode('lock')) { this._unlock(); }\n    else { this._lock(); }\n  },\n\n  _toggleOpacity: function() {\n    var image = this._overlay.getElement();\n    var opacity;\n\n    if (!this.hasTool(L.OpacityAction)) { return; }\n\n    this._transparent = !this._transparent;\n    opacity = this._transparent ? this.options.opacity : 1;\n\n    L.DomUtil.setOpacity(image, opacity);\n    image.setAttribute('opacity', opacity);\n\n    this._refresh();\n  },\n\n  _toggleBorder: function() {\n    var image = this._overlay.getElement();\n    var outline;\n\n    if (!this.hasTool(L.BorderAction)) { return; }\n\n    this._outlined = !this._outlined;\n    outline = this._outlined ? this.options.outline : 'none';\n\n    image.style.outline = outline;\n\n    this._refresh();\n  },\n\n  // compare this to using overlay zIndex\n  _toggleOrder: function() {\n    if (this._toggledImage) { this._stackUp(); }\n    else { this._stackDown(); }\n  },\n\n  _removeOverlay: function() {\n    var ov = this._overlay;\n    var eP = this.parentGroup;\n\n    if (this.isMode('lock') || !this.hasTool(L.DeleteAction)) { return; }\n\n    var choice = L.DomUtil.confirmDelete();\n    if (!choice) { return; }\n\n    this._removeToolbar();\n\n    if (eP) { eP.removeLayer(ov); }\n    else { ov._map.removeLayer(ov); }\n  },\n\n  // Based on https://github.com/publiclab/mapknitter/blob/8d94132c81b3040ae0d0b4627e685ff75275b416/app/assets/javascripts/mapknitter/Map.js#L47-L82\n  _getExport: function() {\n    var overlay = this._overlay;\n    var map = overlay._map;\n    var img = overlay.getElement();\n\n    if (!this.hasTool(L.ExportAction)) { return; }\n\n    // make a new image\n    var downloadable = new Image();\n\n    downloadable.id = downloadable.id || 'tempId12345';\n    document.body.appendChild(downloadable);\n\n    downloadable.onload = function onLoadDownloadableImage() {\n      var height = downloadable.height;\n      var width = downloadable.width;\n      var nw = map.latLngToLayerPoint(overlay.getCorner(0));\n      var ne = map.latLngToLayerPoint(overlay.getCorner(1));\n      var sw = map.latLngToLayerPoint(overlay.getCorner(2));\n      var se = map.latLngToLayerPoint(overlay.getCorner(3));\n\n      // I think this is to move the image to the upper left corner,\n      // eslint-disable-next-line max-len\n      // jywarren: i think we may need these or the image goes off the edge of the canvas\n      // jywarren: but these seem to break the distortion math...\n\n      // jywarren: i think it should be rejiggered so it\n      // finds the most negative values of x and y and then\n      // adds those to all coordinates\n\n      // nw.x -= nw.x;\n      // ne.x -= nw.x;\n      // se.x -= nw.x;\n      // sw.x -= nw.x;\n\n      // nw.y -= nw.y;\n      // ne.y -= nw.y;\n      // se.y -= nw.y;\n      // sw.y -= nw.y;\n\n      // run once warping is complete\n      downloadable.onload = function() {\n        L.DomUtil.remove(downloadable);\n      };\n\n      if (window && window.hasOwnProperty('warpWebGl')) {\n        warpWebGl(\n            downloadable.id,\n            [0, 0, width, 0, width, height, 0, height],\n            [nw.x, nw.y, ne.x, ne.y, se.x, se.y, sw.x, sw.y],\n            true // trigger download\n        );\n      }\n    };\n\n    downloadable.src = overlay.options.fullResolutionSrc || img.src;\n  },\n\n  _stackUp: function() {\n    var t = this._toggledImage;\n\n    if (!t || !this.hasTool(L.StackAction)) { return; }\n\n    this._toggledImage = false;\n    this._overlay.bringToFront();\n    this._refresh();\n  },\n\n  _stackDown: function() {\n    var t = this._toggledImage;\n\n    if (t || !this.hasTool(L.StackAction)) { return; }\n\n    this._toggledImage = true;\n    this._overlay.bringToBack();\n    this._refresh();\n  },\n\n  _unlock: function() {\n    var ov = this._overlay;\n    var map = ov._map;\n    var eP = this.parentGroup;\n\n    if (!this.isMode('lock')) { return; }\n    if ((eP && !eP.isCollected(ov)) || !eP) {\n      if (!this.hasTool(L.LockAction)) { return; }\n    }\n\n    if (this.currentHandle) { map.removeLayer(this.currentHandle); }\n    if (ov.options.mode === 'lock' || !this.hasMode(ov.options.mode)) {\n      this._mode = '';\n      this.currentHandle = '';\n    } else {\n      this._mode = ov.options.mode;\n    }\n    this._updateHandle();\n    this._enableDragging();\n    this._refresh();\n  },\n\n  _lock: function() {\n    var ov = this._overlay;\n    var map = ov._map;\n    var eP = this.parentGroup;\n\n    if (this.isMode('lock')) { return; }\n    if ((eP && !eP.isCollected(ov)) || !eP) {\n      if (!this.hasTool(L.LockAction)) { return; }\n    }\n\n    if (this.currentHandle) { map.removeLayer(this.currentHandle); }\n    this._mode = 'lock';\n    this._updateHandle();\n    this._disableDragging();\n    this._refresh();\n  },\n\n  _deselect: function() {\n    this._overlay.deselect();\n  },\n\n  _showMarkers: function(e) {\n    var eP = this.parentGroup;\n\n    if (!this.currentHandle) { return; }\n    // only markers we want in collect interface for now is lock\n    if (!this.isMode('lock') && (eP && eP.anyCollected())) { return; }\n\n    this.currentHandle.eachLayer((handle) => {\n      handle.setOpacity(1);\n      if (handle.dragging) { handle.dragging.enable(); }\n      L.DomUtil.addClass(handle.getElement(), 'leaflet-interactive');\n    });\n  },\n\n  _hideMarkers: function() {\n    var ov = this._overlay;\n    var eP = this.parentGroup;\n\n    // workaround for race condition w/ feature group\n    if (!this._handles) { this._initHandles(); }\n\n    if (!this.currentHandle) { return; }\n    if (this.isMode('lock') && (eP && eP.isCollected(ov))) { return; }\n\n    this.currentHandle.eachLayer((handle) => {\n      handle.setOpacity(0);\n      if (handle.dragging) { handle.dragging.disable(); }\n      L.DomUtil.removeClass(handle.getElement(), 'leaflet-interactive');\n    });\n  },\n\n  _updateHandle: function() {\n    var ov = this._overlay;\n    var map = ov._map;\n    var mode = this.getMode();\n\n    if (this.currentHandle) { map.removeLayer(this.currentHandle); }\n    this.currentHandle = mode === '' ? '' : this._handles[mode];\n    if (this.currentHandle !== '') {\n      map.addLayer(this.currentHandle);\n    }\n  },\n\n  _addToolbar: function() {\n    var ov = this._overlay;\n    var eP = this.parentGroup;\n    var map = ov._map;\n    // Find the topmost point on the image.\n    var corners = ov.getCorners();\n    var maxLat = -Infinity;\n\n    if (eP && eP.anyCollected()) {\n      eP.editing._addToolbar();\n      return;\n    }\n\n    if (ov.options.suppressToolbar || this.toolbar) { return; }\n\n    for (var i = 0; i < corners.length; i++) {\n      if (corners[i].lat > maxLat) {\n        maxLat = corners[i].lat;\n      }\n    }\n\n    // Longitude is based on the centroid of the image.\n    var raisedPoint = ov.getCenter();\n    raisedPoint.lat = maxLat;\n\n    this.toolbar = L.distortableImage.popupBar(raisedPoint, {\n      actions: this.editActions,\n    }).addTo(map, ov);\n    ov.fire('toolbar:created');\n  },\n\n  _refresh: function() {\n    if (this.toolbar) { this._removeToolbar(); }\n    this._addToolbar();\n  },\n\n  _updateToolbarPos: function() {\n    var overlay = this._overlay;\n    // Find the topmost point on the image.\n    var corners = overlay.getCorners();\n    var toolbar = this.toolbar;\n    var maxLat = -Infinity;\n\n    if (toolbar && toolbar instanceof L.DistortableImage.PopupBar) {\n      for (var i = 0; i < corners.length; i++) {\n        if (corners[i].lat > maxLat) {\n          maxLat = corners[i].lat;\n        }\n      }\n\n      // Longitude is based on the centroid of the image.\n      var raisedPoint = overlay.getCenter();\n      raisedPoint.lat = maxLat;\n\n      if (!overlay.options.suppressToolbar) {\n        this.toolbar.setLatLng(raisedPoint);\n      }\n    }\n  },\n\n  hasMode: function(mode) {\n    return !!this._modes[mode];\n  },\n\n  getMode: function() {\n    if (!this.enabled()) { return; }\n    return this._mode;\n  },\n\n  getModes: function() {\n    return this._modes;\n  },\n\n  isMode: function(mode) {\n    if (!this.enabled()) { return false; }\n    return this._mode === mode;\n  },\n\n  setMode: function(newMode) {\n    var ov = this._overlay;\n    var eP = this.parentGroup;\n    var mode = this.getMode();\n\n    if (mode === newMode || !this.hasMode(newMode) || !this.enabled()) {\n      return;\n    }\n\n    if (this.toolbar) { this.toolbar.clickTool(newMode); }\n    if (this.isMode('lock') && !this.dragging) { this._enableDragging(); }\n    this._mode = newMode;\n    if (this.isMode('lock')) { this._disableDragging(); }\n    this._updateHandle();\n    this._refresh();\n\n    if (eP && eP.isCollected(ov)) { ov.deselect(); }\n\n    return this;\n  },\n\n  /**\n    * need to attach a stop to img dblclick or it will propagate to\n    * the map and fire the handler that shows map location labels on map dblclick.\n    */\n  nextMode: function(e) {\n    var mode = this.getMode();\n    var eP = this.parentGroup;\n    var modesArray = Object.keys(this.getModes());\n    var idx = modesArray.indexOf(mode);\n    var nextIdx = (idx + 1) % modesArray.length;\n    var newMode = modesArray[nextIdx];\n\n    if (e) {\n      if (eP && eP.anyCollected()) { return; }\n      L.DomEvent.stop(e);\n    }\n\n    return this.setMode(newMode);\n  },\n});\n\nL.distortableImage.edit = function(overlay, options) {\n  return new L.DistortableImage.Edit(overlay, options);\n};\n","L.DistortableImage = L.DistortableImage || {};\n\n// this class holds the keybindings and toolbar API for an image collection instance\nL.DistortableCollection.Edit = L.Handler.extend({\n  options: {\n    keymap: L.distortableImage.group_action_map,\n  },\n\n  initialize(group, options) {\n    this._group = group;\n    this._exportOpts = group.options.exportOpts;\n\n    L.setOptions(this, options);\n\n    L.distortableImage.group_action_map.Escape = '_decollectAll';\n  },\n\n  addHooks() {\n    const group = this._group;\n    const map = group._map;\n\n    this.editActions = this.options.actions;\n    this.runExporter =\n        L.bind(L.Utils.getNestedVal(this, '_exportOpts', 'exporter') ||\n        this.startExport, this);\n\n    L.DomEvent.on(document, 'keydown', this._onKeyDown, this);\n\n    if (!(map.doubleClickZoom.enabled() || map.doubleClickLabels.enabled())) {\n      L.DomEvent.on(map, 'click', this._decollectAll, this);\n    }\n\n    L.DomEvent.on(map, {\n      singleclickon: this._singleClickListeners,\n      singleclickoff: this._resetClickListeners,\n      singleclick: this._singleClick,\n      boxcollectend: this._addCollections,\n    }, this);\n\n    this._group.editable = true;\n    this._group.eachLayer(layer => layer.editing.enable());\n  },\n\n  removeHooks() {\n    const group = this._group;\n    const map = group._map;\n\n    L.DomEvent.off(document, 'keydown', this._onKeyDown, this);\n\n    if (!(map.doubleClickZoom.enabled() || map.doubleClickLabels.enabled())) {\n      L.DomEvent.off(map, 'click', this._decollectAll, this);\n    }\n\n    L.DomEvent.off(map, {\n      singleclickon: this._singleClickListeners,\n      singleclickoff: this._resetClickListeners,\n      singleclick: this._singleClick,\n      boxcollectend: this._addCollections,\n    }, this);\n\n    this._decollectAll();\n    this._group.editable = false;\n    this._group.eachLayer(layer => layer.editing.disable());\n  },\n\n  enable() {\n    this._enabled = true;\n    this.addHooks();\n    return this;\n  },\n\n  disable() {\n    this._enabled = false;\n    this.removeHooks();\n    return this;\n  },\n\n  _onKeyDown(e) {\n    const keymap = this.options.keymap;\n    const handlerName = keymap[e.key];\n\n    if (!this[handlerName]) { return; }\n\n    if (this._group.anyCollected()) {\n      this[handlerName].call(this);\n    }\n  },\n\n  _singleClick(e) {\n    if (e.type === 'singleclick') { this._decollectAll(e); }\n    else { return; }\n  },\n\n  _singleClickListeners() {\n    const map = this._group._map;\n    L.DomEvent.off(map, 'click', this._decollectAll, this);\n    L.DomEvent.on(map, 'singleclick', this._decollectAll, this);\n  },\n\n  _resetClickListeners() {\n    const map = this._group._map;\n    L.DomEvent.on(map, 'click', this._decollectAll, this);\n    L.DomEvent.off(map, 'singleclick', this._decollectAll, this);\n  },\n\n  _decollectAll(e) {\n    let oe;\n\n    if (e) { oe = e.originalEvent; }\n    /**\n     * prevents image deselection following the 'boxcollectend' event - note 'shift' must not be released until dragging is complete\n     * also prevents deselection following a click on a disabled img by differentiating it from the map\n     */\n    if (oe && (oe.shiftKey || oe.target instanceof HTMLImageElement)) {\n      return;\n    }\n\n    this._group.eachLayer((layer) => {\n      L.DomUtil.removeClass(layer.getElement(), 'collected');\n      layer.deselect();\n    });\n\n    this._removeToolbar();\n\n    if (e) { L.DomEvent.stopPropagation(e); }\n  },\n\n  _unlockGroup() {\n    if (!this.hasTool(L.UnlockAction)) { return; }\n\n    this._group.eachLayer((layer) => {\n      if (this._group.isCollected(layer)) {\n        const edit = layer.editing;\n        edit._unlock();\n        // unlock updates the layer's handles; deselect to ensure they're hidden\n        layer.deselect();\n      }\n    });\n  },\n\n  _lockGroup() {\n    if (!this.hasTool(L.LockAction)) { return; }\n\n    this._group.eachLayer((layer) => {\n      if (this._group.isCollected(layer) ) {\n        const edit = layer.editing;\n        edit._lock();\n        // map.addLayer also deselects the image, so we reselect here\n        L.DomUtil.addClass(layer.getElement(), 'collected');\n      }\n    });\n  },\n\n  _addCollections(e) {\n    const box = e.boxCollectBounds;\n    const map = this._group._map;\n\n    this._group.eachLayer((layer) => {\n      const edit = layer.editing;\n\n      if (layer.isSelected()) { layer.deselect(); }\n\n      const zoom = map.getZoom();\n      const center = map.getCenter();\n      let imgBounds = L.latLngBounds(layer.getCorner(2), layer.getCorner(1));\n\n      imgBounds = map._latLngBoundsToNewLayerBounds(imgBounds, zoom, center);\n      if (box.intersects(imgBounds) && edit.enabled()) {\n        if (!this.toolbar) { this._addToolbar(); }\n        L.DomUtil.addClass(layer.getElement(), 'collected');\n      }\n    });\n  },\n\n  _removeGroup(e) {\n    if (!this.hasTool(L.DeleteAction)) { return; }\n\n    const layersToRemove = this._group._toRemove();\n    const n = layersToRemove.length;\n\n    if (n === 0) { return; }\n\n    const choice = L.DomUtil.confirmDeletes(n);\n\n    if (choice) {\n      layersToRemove.forEach((layer) => {\n        this._group.removeLayer(layer);\n      });\n      if (!this._group.anyCollected()) {\n        this._removeToolbar();\n      }\n    }\n\n    if (e) { L.DomEvent.stopPropagation(e); }\n  },\n\n  cancelExport() {\n    if (!this.customCollection) {\n      this._exportOpts.collection = undefined;\n    }\n\n    clearInterval(this.updateInterval);\n  },\n\n  _addToolbar() {\n    const group = this._group;\n    const map = group._map;\n\n    if (group.options.suppressToolbar || this.toolbar) { return; }\n\n    this.toolbar = L.distortableImage.controlBar({\n      actions: this.editActions,\n      position: 'topleft',\n    }).addTo(map, group);\n  },\n\n  _removeToolbar() {\n    const map = this._group._map;\n    if (this.toolbar) {\n      map.removeLayer(this.toolbar);\n      this.toolbar = false;\n    } else {\n      return false;\n    }\n  },\n\n  hasTool(value) {\n    return this.editActions.some(action => action === value);\n  },\n\n  addTool(value) {\n    if (value.baseClass === 'leaflet-toolbar-icon' && !this.hasTool(value)) {\n      this._removeToolbar();\n      this.editActions.push(value);\n      this._addToolbar();\n    }\n    return this;\n  },\n\n  removeTool(value) {\n    this.editActions.some((item, idx) => {\n      if (this.editActions[idx] === value) {\n        this._removeToolbar();\n        this.editActions.splice(idx, 1);\n        this._addToolbar();\n        return true;\n      } else {\n        return false;\n      }\n    });\n    return this;\n  },\n\n  startExport() {\n    if (!this.hasTool(L.ExportAction)) { return; }\n\n    return new Promise((resolve) => {\n      const opts = this._exportOpts;\n      opts.resolve = resolve; // allow resolving promise in user-defined functions, to stop spinner on completion\n\n      let statusUrl;\n      this.updateInterval = null;\n\n      // this may be overridden to update the UI to show export progress or completion\n      const _defaultUpdater = (data) => {\n        data = JSON.parse(data);\n        // optimization: fetch status directly from google storage:\n        if (data.status_url) {\n          if (statusUrl !== data.status_url && data.status_url.match('.json')) {\n            // if (data.status_url && data.status_url.substr(0,1) === \"/\") {\n            //   opts.statusUrl = opts.statusUrl + data.status_url;\n            // } else {\n            statusUrl = data.status_url;\n            // }\n          }\n\n          if (data.status === 'complete') {\n            clearInterval(this.updateInterval);\n\n            if (!this.customCollection) {\n              this._exportOpts.collection = undefined;\n            }\n\n            resolve();\n            if (data.jpg !== null) {\n              alert('Export succeeded. ' + opts.exportUrl + data.jpg);\n            }\n          }\n\n          // TODO: update to clearInterval when status == \"failed\" if we update that in this file:\n          // https://github.com/publiclab/mapknitter-exporter/blob/main/lib/mapknitterExporter.rb\n          console.log(data);\n        }\n      };\n\n      // receives the URL of status.json, and starts running the updater to repeatedly fetch from status.json;\n      // this may be overridden to integrate with any UI\n      const _defaultHandleStatusRes = (data) => {\n        statusUrl = opts.statusUrl + data;\n        // repeatedly fetch the status.json\n        this.updateInterval = setInterval(() => {\n          const reqOpts = {method: 'GET'};\n          const req = new Request(`${statusUrl}?${Date.now()}`, reqOpts);\n          fetch(req).then((res) => {\n            if (res.ok) {\n              return res.text();\n            }\n          }).then(opts.updater);\n        }, opts.frequency);\n      };\n\n      // initiate the export\n      const _defaultFetchStatusUrl = (mergedOpts) => {\n        const form = new FormData();\n        form.append('collection', JSON.stringify(mergedOpts.collection));\n        form.append('scale', mergedOpts.scale);\n        form.append('upload', true);\n\n        const reqOpts = {method: 'POST', body: form};\n        const req = new Request(mergedOpts.exportStartUrl, reqOpts);\n        fetch(req).then((res) => {\n          if (res.ok) {\n            return res.text();\n          }\n        }).then(mergedOpts.handleStatusRes);\n      };\n\n      // If the user has passed collection property\n      this.customCollection = !!opts.collection;\n      if (!this.customCollection) {\n        opts.collection = this._group.generateExportJson().images;\n      }\n\n      opts.frequency = opts.frequency || 3000;\n      opts.scale = opts.scale || 100; // switch it to _getAvgCmPerPixel !\n      opts.updater = opts.updater || _defaultUpdater;\n      opts.handleStatusRes = opts.handleStatusRes || _defaultHandleStatusRes;\n      opts.fetchStatusUrl = opts.fetchStatusUrl || _defaultFetchStatusUrl;\n\n      opts.fetchStatusUrl(opts);\n    });\n  },\n});\n\nL.distortableCollection.edit = (group, options) => {\n  return new L.DistortableCollection.Edit(group, options);\n};\n","L.DomUtil = L.DomUtil || {};\nL.DistortableImage = L.DistortableImage || {};\nL.distortableImage = L.DistortableImage;\n\nL.DistortableImage.Keymapper = L.Handler.extend({\n\n  options: {\n    position: 'topright',\n  },\n\n  initialize: function(map, options) {\n    this._map = map;\n    L.setOptions(this, options);\n  },\n\n  addHooks: function() {\n    if (!this._keymapper) {\n      this._container = this._buildContainer();\n      this._scrollWrapper = this._wrap();\n      this._toggler = this._createButton();\n      this._setMapper(this._container, this._scrollWrapper, this._toggler);\n\n      L.DomEvent.on(this._toggler, 'click', this._toggleKeymapper, this);\n\n      L.DomEvent.disableClickPropagation(this._container);\n      L.DomEvent.disableScrollPropagation(this._container);\n    }\n  },\n\n  removeHooks: function() {\n    if (this._keymapper) {\n      L.DomEvent.off(this._toggler, 'click', this._toggleKeymapper, this);\n\n      L.DomUtil.remove(this._toggler);\n      L.DomUtil.remove(this._scrollWrapper);\n      L.DomUtil.remove(this._container);\n      this._keymapper = false;\n    }\n  },\n\n  _buildContainer: function() {\n    var container = L.DomUtil.create('div', 'ldi-keymapper-hide');\n    container.setAttribute('id', 'ldi-keymapper');\n\n    var divider = L.DomUtil.create('br', 'divider');\n    container.appendChild(divider);\n\n    return container;\n  },\n\n  _createButton: function() {\n    var toggler = L.DomUtil.create('a', '');\n    toggler.innerHTML = L.IconUtil.create('keyboard_open');\n\n    toggler.setAttribute('id', 'toggle-keymapper');\n    toggler.setAttribute('href', '#');\n    toggler.setAttribute('title', 'Show keymap');\n    // Will force screen readers like VoiceOver to read this as \"Show keymap - button\"\n    toggler.setAttribute('role', 'button');\n    toggler.setAttribute('aria-label', 'Show keymap');\n\n    return toggler;\n  },\n\n  _wrap: function() {\n    var wrap = L.DomUtil.create('div', '');\n    wrap.setAttribute('id', 'keymapper-wrapper');\n    wrap.style.display = 'none';\n\n    return wrap;\n  },\n\n  _setMapper: function(container, wrap, button) {\n    this._keymapper = L.control({position: this.options.position});\n\n    this._keymapper.onAdd = function() {\n      container.appendChild(wrap);\n      wrap.insertAdjacentHTML(\n          'beforeend',\n          '<table><tbody>' +\n          '<hr id=\"keymapper-hr\">' +\n          /* eslint-disable */\n          '<tr><td><div class=\"left\"><span>Rotate Mode</span></div><div class=\"right\"><kbd>R</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>RotateScale Mode</span></div><div class=\"right\"><kbd>r</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Scale Mode</span></div><div class=\"right\"><kbd>s</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Distort Mode</span></div><div class=\"right\"><kbd>d</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Drag Mode</span></div><div class=\"right\"><kbd>D</kbd></div></td></tr>' +   \n          '<tr><td><div class=\"left\"><span>Lock (Mode) / Unlock Image</span></div><div class=\"right\"><kbd>l</kbd>\\xa0<kbd>u</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Stack up / down</span></div><div class=\"right\"><kbd>q</kbd>\\xa0<kbd>a</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Add / Remove Image Border</span></div><div class=\"right\"><kbd>b</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Toggle Opacity</span></div><div class=\"right\"><kbd>o</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Deselect All</span></div><div class=\"right\"><kbd>esc</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Delete Image(s)</span></div><div class=\"right\"><kbd>delete</kbd>\\xa0<kbd>backspace</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Export Image(s)</span></div><div class=\"right\"><kbd>e</kbd></div></td></tr>' +\n          '</tbody></table>'\n      );\n      /* eslint-enable */\n      container.appendChild(button);\n      return container;\n    };\n\n    this._keymapper.addTo(this._map);\n  },\n\n  _toggleKeymapper: function(e) {\n    e.preventDefault();\n\n    this._container.className = (\n      this._container.className === 'ldi-keymapper leaflet-control' ?\n        'ldi-keymapper-hide leaflet-control' :\n        'ldi-keymapper leaflet-control'\n    );\n\n    this._scrollWrapper.style.display = (\n      this._scrollWrapper.style.display === 'none' ? 'block' : 'none'\n    );\n\n    this._toggler.innerHTML = (\n      this._toggler.innerHTML === 'close' ?\n        L.IconUtil.create('keyboard_open') :\n        'close'\n    );\n\n    L.IconUtil.toggleTitle(this._toggler, 'Show keymap', 'Hide keymap');\n    L.DomUtil.toggleClass(this._toggler, 'close-icon');\n  },\n\n  _injectIconSet: function() {\n    if (document.querySelector('#keymapper-iconset')) { return; }\n\n    var el = L.DomUtil.create('div', '');\n    el.id = 'keymapper-iconset';\n    el.setAttribute('hidden', 'hidden');\n\n    this._iconset = new L.KeymapperIconSet().render();\n    el.innerHTML = this._iconset;\n\n    document.querySelector('.leaflet-control-container').appendChild(el);\n  },\n});\n\nL.DistortableImage.Keymapper.addInitHook(function() {\n  L.DistortableImage.Keymapper.prototype._n = (\n    L.DistortableImage.Keymapper.prototype._n ?\n    L.DistortableImage.Keymapper.prototype._n + 1 :\n    1\n  );\n  // dont enable keymapper for mobile\n  if (L.DistortableImage.Keymapper.prototype._n === 1 && !L.Browser.mobile) {\n    this.enable();\n    this._injectIconSet();\n  }\n});\n\nL.distortableImage.keymapper = function(map, options) {\n  return new L.DistortableImage.Keymapper(map, options);\n};\n","/**\n * `L.Map.DoubleClickZoom` from leaflet 1.5.1, overrwritten so that it\n * 1) Fires a `singleclick` event to avoid deselecting images on `dblclick`.\n * 2) Maintains a mutually exclusive relationship with the map's `DoubleClickLabels` handler\n */\nL.Map.DoubleClickZoom.include({\n  addHooks() {\n    this._map.on({\n      click: this._fireIfSingle,\n      dblclick: this._onDoubleClick,\n    }, this);\n  },\n\n  removeHooks() {\n    this._map.off({\n      click: this._fireIfSingle,\n      dblclick: this._onDoubleClick,\n    }, this);\n  },\n\n  enable() {\n    if (this._enabled) { return this; }\n\n    // don't enable 'doubleClickZoom' unless 'doubleClickLabels' is disabled first\n    if (this._map.doubleClickLabels) {\n      if (this._map.doubleClickLabels.enabled()) {\n        return this;\n      }\n    }\n\n    // signify to collection/instance classes to turn on 'singleclick' listeners\n    this._map.fire('singleclickon');\n\n    this._enabled = true;\n    this.addHooks();\n    return this;\n  },\n\n  disable() {\n    if (!this._enabled) { return this; }\n\n    // signify to collection/instance safe to swap 'singleclick' listeners with 'click' listeners.\n    this._map.fire('singleclickoff');\n\n    this._enabled = false;\n    this.removeHooks();\n    return this;\n  },\n\n  _fireIfSingle(e) {\n    var map = this._map;\n    var oe = e.originalEvent;\n\n    // prevents deselection in case of box selector\n    if (oe && oe.shiftKey) { return; }\n\n    map._clicked += 1;\n    this._map._clickTimeout = setTimeout(function() {\n      if (map._clicked === 1) {\n        map._clicked = 0;\n        map.fire('singleclick', {type: 'singleclick'});\n      } else {\n        // manually fire doubleclick event only for touch screens that don't natively fire it\n        if (L.Browser.touch && (oe && oe.sourceCapabilities.firesTouchEvents)) {\n          // in `DoubleClickLabels.js`, we just do map.fire('dblclick') bc `_onDoublClick` doesn't use the\n          // passed \"e\" (for now). To generate a 'real' DOM event that will have all of its corresponding core\n          // properties (originalEvent, latlng, etc.), use Leaflet's `#map._fireDOMEvent` (Leaflet 1.5.1 source)\n          map._fireDOMEvent(oe, 'dblclick', [map]);\n        }\n      }\n    }, 250);\n  },\n\n  _onDoubleClick(e) {\n    var map = this._map;\n    var oe = e.originalEvent;\n\n    setTimeout(function() {\n      map._clicked = 0;\n      clearTimeout(map._clickTimeout);\n    }, 0);\n\n    if (!oe) { return false; }\n\n    var oldZoom = map.getZoom();\n    var delta = map.options.zoomDelta;\n    var zoom = oe.shiftKey ? oldZoom - delta : oldZoom + delta;\n\n    if (map.options.doubleClickZoom === 'center') {\n      map.setZoom(zoom);\n    } else {\n      map.setZoomAround(e.containerPoint, zoom);\n    }\n  },\n});\n","L.Map.mergeOptions({\n  boxCollector: true,\n  boxZoom: false,\n});\n\n/**\n * primarily Leaflet 1.5.1 source code. Overriden so that it's a collection box used with\n * our `L.DistortableCollection` class instead of a zoom box.\n * */\nL.Map.BoxCollector = L.Map.BoxZoom.extend({\n  initialize: function(map) {\n    this._map = map;\n    this._container = map._container;\n    this._pane = map._panes.overlayPane;\n    this._resetStateTimeout = 0;\n    map.on('unload', this._destroy, this);\n  },\n\n  addHooks: function() {\n    L.DomEvent.on(this._container, 'mousedown', this._onMouseDown, this);\n  },\n\n  removeHooks: function() {\n    L.DomEvent.off(this._container, 'mousedown', this._onMouseDown, this);\n  },\n\n  moved: function() {\n    return this._moved;\n  },\n\n  _destroy: function() {\n    L.DomUtil.remove(this._pane);\n    delete this._pane;\n  },\n\n  _resetState: function() {\n    this._resetStateTimeout = 0;\n    this._moved = false;\n  },\n\n  _clearDeferredResetState: function() {\n    if (this._resetStateTimeout !== 0) {\n      clearTimeout(this._resetStateTimeout);\n      this._resetStateTimeout = 0;\n    }\n  },\n\n  _onMouseDown: function(e) {\n    if (!e.shiftKey || (e.which !== 1 && e.button !== 1)) {\n      return false;\n    }\n\n    // Clear the deferred resetState if it hasn't executed yet, otherwise it\n    // will interrupt the interaction and orphan a box element in the container.\n    this._clearDeferredResetState();\n    this._resetState();\n\n    L.DomUtil.disableTextSelection();\n    L.DomUtil.disableImageDrag();\n\n    this._startPoint = this._map.mouseEventToContainerPoint(e);\n\n    L.DomEvent.on(document, {\n      contextmenu: L.DomEvent.stop,\n      mousemove: this._onMouseMove,\n      mouseup: this._onMouseUp,\n    }, this);\n  },\n\n  _onMouseMove: function(e) {\n    if (!this._moved) {\n      this._moved = true;\n\n      this._box = L.DomUtil.create('div', 'leaflet-zoom-box', this._container);\n      L.DomUtil.addClass(this._container, 'leaflet-crosshair');\n\n      this._map.fire('boxzoomstart');\n    }\n\n    this._point = this._map.mouseEventToContainerPoint(e);\n\n    this._bounds = L.bounds(this._startPoint, this._point);\n    var size = this._bounds.getSize();\n\n    L.DomUtil.setPosition(this._box, this._bounds.min);\n\n    this._box.style.width = size.x + 'px';\n    this._box.style.height = size.y + 'px';\n  },\n\n  _finish: function() {\n    if (this._moved) {\n      L.DomUtil.remove(this._box);\n      L.DomUtil.removeClass(this._container, 'leaflet-crosshair');\n    }\n\n    L.DomUtil.enableTextSelection();\n    L.DomUtil.enableImageDrag();\n\n    L.DomEvent.off(document, {\n      contextmenu: L.DomEvent.stop,\n      mousemove: this._onMouseMove,\n      mouseup: this._onMouseUp,\n    }, this);\n  },\n\n  _onMouseUp: function(e) {\n    if (e.which !== 1 && e.button !== 1) {\n      return;\n    }\n\n    this._finish();\n\n    if (!this._moved) { return; }\n\n    // Postpone to next JS tick so internal click event handling\n    // still see it as \"moved\".\n    this._clearDeferredResetState();\n    this._resetStateTimeout = setTimeout(\n        L.Util.bind(this._resetState, this), 0);\n\n    var bounds = L.latLngBounds(\n        this._map.containerPointToLatLng(this._bounds.getBottomLeft()),\n        this._map.containerPointToLatLng(this._bounds.getTopRight())\n    );\n\n    var zoom = this._map.getZoom();\n    var center = this._map.getCenter();\n\n    // calls the `project` method but 1st updates the pixel origin - see https://github.com/publiclab/Leaflet.DistortableImage/pull/344\n    bounds = this._map._latLngBoundsToNewLayerBounds(bounds, zoom, center);\n\n    this._map.fire('boxcollectend', {boxCollectBounds: bounds});\n  },\n});\n\nL.Map.addInitHook('addHandler', 'boxCollector', L.Map.BoxCollector);\n","L.Map.mergeOptions({\n  doubleClickLabels: true,\n});\n\n/**\n * The `doubleClickLabels` handler replaces `doubleClickZoom` by default if `#addGoogleMutant`\n * is used unless the options 'labels: false' or 'doubleClickZoom: false` were passed to it.\n */\nL.Map.DoubleClickLabels = L.Map.DoubleClickZoom.extend({\n  enable: function() {\n    var map = this._map;\n\n    if (this._enabled) { return this; }\n\n    // disable 'doubleClickZoom' if 'doubleClickLabels' is enabled.\n    if (map.doubleClickZoom.enabled()) {\n      map.doubleClickZoom.disable();\n    }\n\n    this._map.fire('singleclickon');\n\n    this._enabled = true;\n    this.addHooks();\n    return this;\n  },\n\n  disable: function() {\n    if (!this._enabled) { return this; }\n\n    this._enabled = false;\n    this.removeHooks();\n\n    return this;\n  },\n\n  _fireIfSingle: function(e) {\n    var map = this._map;\n    var oe = e.originalEvent;\n\n    // prevents deselection in case of box selector\n    if (oe && oe.shiftKey) { return; }\n\n    map._clicked += 1;\n    this._map._clickTimeout = setTimeout(function() {\n      if (map._clicked === 1) {\n        map._clicked = 0;\n        map.fire('singleclick', {type: 'singleclick'});\n      } else {\n        // manually fire doubleclick event only for touch screens that don't natively fire it\n        if (L.Browser.touch && (oe && oe.sourceCapabilities.firesTouchEvents)) {\n          map.fire('dblclick');\n        }\n      }\n    }, 250);\n  },\n\n  _onDoubleClick: function() {\n    var map = this._map;\n    var labels = map._labels;\n\n    setTimeout(function() {\n      map._clicked = 0;\n      clearTimeout(map._clickTimeout);\n    }, 0);\n\n    if (!labels) { return; }\n\n    if (labels.options.opacity === 1) {\n      labels.options.opacity = 0;\n      labels.setOpacity(0);\n    } else {\n      labels.options.opacity = 1;\n      labels.setOpacity(1);\n    }\n  },\n});\n\nL.Map.addInitHook('addHandler', 'doubleClickLabels', L.Map.DoubleClickLabels);\n","/* eslint-disable max-len */\nL.Map.include({\n\n  _clicked: 0,\n\n  addGoogleMutant(opts) {\n    var url = 'http://mt0.google.com/vt/lyrs=s&x={x}&y={y}&z={z}';\n\n    opts = this.mutantOptions = L.extend({\n      mutantOpacity: 0.8,\n      maxZoom: 24,\n      maxNativeZoom: 20,\n      minZoom: 0,\n      labels: true,\n      labelOpacity: 1,\n      doubleClickLabels: true,\n    }, opts);\n\n    if (!opts.labels) {\n      this.mutantOptions = L.extend(this.mutantOptions, {\n        labelOpacity: opts.labels ? 1 : undefined,\n        doubleClickLabels: opts.labels ? true : undefined,\n      });\n    }\n\n    this._googleMutant = L.tileLayer(url, {\n      maxZoom: opts.maxZoom,\n      maxNativeZoom: opts.maxNativeZoom,\n      minZoom: opts.minZoom,\n      opacity: opts.mutantOpacity,\n    }).addTo(this);\n\n    if (opts.labels) { this._addLabels(opts); }\n    // shouldn't have this handler at all if there are no labels to toggle\n    else {\n      this.doubleClickLabels = undefined;\n    }\n\n    return this;\n  },\n\n  _addLabels(opts) {\n    var url = 'https://stamen-tiles-{s}.a.ssl.fastly.net/toner-labels/{z}/{x}/{y}{r}.{ext}';\n\n    if (opts.labelOpacity !== 0 && opts.labelOpacity !== 1) {\n      opts.labelOpacity = 1;\n    }\n\n    this._labels = L.tileLayer(url, {\n      attribution: 'Map tiles by <a href=\"http://stamen.com\">Stamen Design</a>, <a href=\"http://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a> &mdash; Map data &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n      subdomains: 'abcd',\n      interactive: false,\n      opacity: opts.labelOpacity,\n      maxZoom: opts.maxZoom,\n      maxNativeZoom: opts.maxNativeZoom,\n      minZoom: opts.minZoom,\n      ext: 'png',\n    }).addTo(this);\n\n    if (this.mutantOptions.doubleClickLabels) {\n      this.doubleClickLabels.enable();\n    }\n\n    return this;\n  },\n});\n// start off with doubleClickZoom enabled, doubleClickLabels can later be enabled instead\n// during initialization\nL.Map.addInitHook(function() {\n  this.doubleClickLabels.disable();\n  this.doubleClickZoom.enable();\n});\n"],"sourceRoot":""}